
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analysing drum patterns from MIDI files &#8212; Musikinformatik SoSe2021</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/thebelab.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/thebelab-helper.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Python basics" href="../docs/basics/python.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">Musikinformatik SoSe2021</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  Course information
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/course-info/setup.html">
   Environment setup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/bib.html">
   Bibliography
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Basics
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/basics/math.html">
   Math basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/basics/python.html">
   Python basics
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Lesson 1
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Analysing drum patterns from MIDI files
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/01_midi_drums/01_midi_drums.ipynb.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/capital-G/musikinformatik-sose2021"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/capital-G/musikinformatik-sose2021/issues/new?title=Issue%20on%20page%20%2F01_midi_drums/01_midi_drums.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/capital-G/musikinformatik-sose2021/edit/main/01_midi_drums/01_midi_drums.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/capital-G/musikinformatik-sose2021/main?urlpath=tree/01_midi_drums/01_midi_drums.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-the-dataset">
   Getting the dataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#parsing-the-dataset">
   Parsing the dataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#inspecting-the-data">
   Inspecting the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#filter-and-extract-the-data">
   Filter and extract the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="analysing-drum-patterns-from-midi-files">
<h1>Analysing drum patterns from MIDI files<a class="headerlink" href="#analysing-drum-patterns-from-midi-files" title="Permalink to this headline">¶</a></h1>
<p>In our first lesson we want to get to know how to work with datasets so we can</p>
<ul class="simple">
<li><p>parse a dataset</p></li>
<li><p>analyse the dataset so it matches our expectations and we did not screw up during parsing</p></li>
</ul>
<p>After this is done we want to take a look at how we can generate new drum patterns from the existing one.
But in order to do this we want to take a look at the quantisation (?) of our patterns.</p>
<p>The cleaning of the dataset and setting the data up properly takes the most time in such experiments but if one makes errors here those errors will propagate through our system - so its good to spend some time at this task.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">helpers.helpers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>  <span class="c1"># makes the randomness deterministic</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1"># todo: try %matplotlib widget</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.grid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="getting-the-dataset">
<h2>Getting the dataset<a class="headerlink" href="#getting-the-dataset" title="Permalink to this headline">¶</a></h2>
<p>As our methods rely on data we need a way to obtain such data and this will be on of our first endeavours in this machine learning based workshop.
Thankfully there are search engines which help us to find data in the internet easily.
One search results when one searches for <em>midi dataset</em> is <a class="reference external" href="https://colinraffel.com/projects/lmd/">https://colinraffel.com/projects/lmd/</a>.</p>
<blockquote>
<div><p>The Lakh MIDI dataset is a collection of 176,581 unique MIDI files, 45,129 of which have been matched and aligned to entries in the Million Song Dataset. […]</p>
</div></blockquote>
<p>Of course the cultural skewness of such a dataset is a thing we need to be aware of.
What kind of music is transcribable into the MIDI format and what kind of music is transcribed as MIDI at all.
Maybe we can shed some light into the last question by inspecting the dataset.
But before we can do this we need to download and understand the dataset.</p>
<p>We use a function which will check if the files are already downloaded and if not will download and extract the directory.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="k">def</span> <span class="nf">download_dataset</span><span class="p">(</span><span class="n">download_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;../datasets/lmd&quot;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">archive_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_path</span><span class="p">,</span> <span class="s2">&quot;lmd_full&quot;</span><span class="p">)</span>
    
    <span class="n">dl_files</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;midi&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_path</span><span class="p">,</span> <span class="s2">&quot;lmd_full.tap.gz&quot;</span><span class="p">),</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://hog.ee.columbia.edu/craffel/lmd/lmd_full.tar.gz&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;json&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_path</span><span class="p">,</span> <span class="s2">&quot;md5_to_path.json&quot;</span><span class="p">),</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://hog.ee.columbia.edu/craffel/lmd/md5_to_paths.json&quot;</span>
        <span class="p">},</span>
    <span class="p">}</span>
    
    <span class="k">for</span> <span class="n">dl_name</span><span class="p">,</span> <span class="n">dl</span> <span class="ow">in</span> <span class="n">dl_files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dl</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">dl_name</span> <span class="o">==</span> <span class="s2">&quot;midi&quot;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">archive_dir</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dl_name</span><span class="si">}</span><span class="s2"> already downloaded to </span><span class="si">{</span><span class="n">dl</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start downloading </span><span class="si">{</span><span class="n">dl_name</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">dl</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - this can take multiple minutes!&quot;</span><span class="p">)</span>
        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">dl</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">],</span> <span class="n">dl</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finished downloading&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">archive_dir</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start extracting the files of archive - this will take some minutes&quot;</span><span class="p">)</span>
        <span class="c1"># todo: windows has no tar</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span>
            <span class="s1">&#39;tar&#39;</span><span class="p">,</span> <span class="s1">&#39;-xzf&#39;</span><span class="p">,</span> <span class="n">dl_files</span><span class="p">[</span><span class="s2">&quot;midi&quot;</span><span class="p">][</span><span class="s2">&quot;path&quot;</span><span class="p">],</span>
            <span class="s1">&#39;-C&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_path</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished extracting&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dl_files</span><span class="p">[</span><span class="s2">&quot;midi&quot;</span><span class="p">][</span><span class="s2">&quot;path&quot;</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Remove archive&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dl_files</span><span class="p">[</span><span class="s2">&quot;midi&quot;</span><span class="p">][</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>

<span class="n">download_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Start downloading midi to ../datasets/lmd/lmd_full.tap.gz - this can take multiple minutes!
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="parsing-the-dataset">
<h2>Parsing the dataset<a class="headerlink" href="#parsing-the-dataset" title="Permalink to this headline">¶</a></h2>
<p>When working with large sets of files the unix utility <a class="reference external" href="https://en.wikipedia.org/wiki/Glob_(programming)">glob</a> comes in handy as we can describe the pattern of the file paths we want to match instead of listing all files.</p>
<p>When we take a quick look at the pattern it seems they all follow a structure like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">../</span><span class="n">datasets</span><span class="o">/</span><span class="n">lmd</span><span class="o">/</span><span class="n">lmd_full</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="n">a0cbb3f083d14d57858c87b26f85873</span><span class="o">.</span><span class="n">mid</span>
</pre></div>
</div>
<p>Soon we will understand why the filename has this cryptic format, but for now we simply want to parse all available files into an array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;../datasets/lmd/lmd_full/*/*.mid&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">midi_files</span><span class="p">)</span><span class="si">}</span><span class="s1"> midi files in dataset&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found 178561 midi files in dataset
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># select 5 random files</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">midi_files</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;../datasets/lmd/lmd_full/4/4a69b1a10e4dbe409ac922de4f6256d8.mid&#39;,
       &#39;../datasets/lmd/lmd_full/b/b102261b4c27ea58bad4777b5df5be5e.mid&#39;,
       &#39;../datasets/lmd/lmd_full/3/3a8ccaab480919c35f37fdf08c238e29.mid&#39;,
       &#39;../datasets/lmd/lmd_full/d/dc6416232e05b3d44fb62007ca84b474.mid&#39;,
       &#39;../datasets/lmd/lmd_full/4/4fb744a04c1afbb0309b581410b33363.mid&#39;],
      dtype=&#39;&lt;U63&#39;)
</pre></div>
</div>
</div>
</div>
<p>But how are sure that we matched every midi file in our folder?
We can simply match every file in our dataset directory and show us the differences by using <a class="reference external" href="https://realpython.com/python-sets/">sets</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">missed_files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;../datasets/lmd/lmd_full/**/*.*&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">midi_files</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Did not match </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">missed_files</span><span class="p">)</span><span class="si">}</span><span class="s1"> files&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Did not match 0 files
</pre></div>
</div>
</div>
</div>
<p>Thankfully we have a rather clean dataset here which does not force us to do file acrobatics.</p>
<p>But we did not just download MIDI files, we also downloaded a JSON file which we will now take a look into.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../datasets/lmd/md5_to_path.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">md5_filenames</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">md5_filenames</span><span class="p">[</span><span class="s2">&quot;1c83fc02b8c57fbc2605900bb31793fb&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;E/Exaltasamba - Megastar.mid&#39;,
 &#39;Midis Samba e Pagode/Exaltasamba - Megastar.mid&#39;,
 &#39;Midis Samba e Pagode/Exaltasamba - Megastar.mid&#39;]
</pre></div>
</div>
</div>
</div>
<p>So - why do we have an additional file which tells us the original filename?
This is actually a good trick in order to avoid duplicates in the dataset - we use a so called hash function which will return a cryptic string depending on the data that we <em>hash</em>.
Two files will produce the same hash output - so if we simple rename each file to the hash it produces we will automatically delete and detect all duplicates in our dataset.
This is a common practice if the data was obtained by scraping multiple sources for data.</p>
<p>Lets just take a look if we can verify this claim.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hashlib</span>

<span class="n">example_midi_file</span> <span class="o">=</span> <span class="s2">&quot;../datasets/lmd/lmd_full/1/1c83fc02b8c57fbc2605900bb31793fb.mid&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">example_midi_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">file_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">chunk</span> <span class="o">:=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8192</span><span class="p">):</span>
        <span class="n">file_hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hash for </span><span class="si">{</span><span class="n">example_midi_file</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">file_hash</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Hash for ../datasets/lmd/lmd_full/1/1c83fc02b8c57fbc2605900bb31793fb.mid is 1c83fc02b8c57fbc2605900bb31793fb
</pre></div>
</div>
</div>
</div>
<p>This also gives us a nice additional information - a common MIDI file will probably have lots of different names as it was scraped from multiple files which probably changed the filenames a bit.</p>
</div>
<div class="section" id="inspecting-the-data">
<h2>Inspecting the data<a class="headerlink" href="#inspecting-the-data" title="Permalink to this headline">¶</a></h2>
<p>Now as we have all file paths available it is a good practice to take a first look at the data.
We need to understand how the information we are interested in is accessible and also that it is probably not standardized - as we have seen above with the filenames already.</p>
<p>To work with music notation we will use the python library <a class="reference external" href="https://web.mit.edu/music21/">music21</a> from the MIT and <a class="reference external" href="https://github.com/craffel/pretty-midi">pretty_midi</a> to inspect the MIDI files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">music21</span> <span class="kn">import</span> <span class="n">converter</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">example_midi_file</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">midi_files</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Selected </span><span class="si">{</span><span class="n">example_midi_file</span><span class="si">}</span><span class="s1"> as example MIDI file&#39;</span><span class="p">)</span>
<span class="n">example_stream</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">example_midi_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Selected ../datasets/lmd/lmd_full/d/d3121806fccdc6bbdb727e1685c39bd0.mid as example MIDI file
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">stream_string</span><span class="p">(</span><span class="n">example_stream</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{0.0} &lt;music21.stream.Part 0x153a30ca0&gt;
    {0.0} &lt;music21.instrument.Flute &#39;WinJammer Demo: Flute&#39;&gt;
    {0.0} &lt;music21.tempo.MetronomeMark allegretto Quarter=106.0&gt;
    {0.0} &lt;music21.key.Key of C major&gt;
    {0.0} &lt;music21.meter.TimeSignature 4/4&gt;
    {0.0} &lt;music21.note.Rest rest&gt;
    {52.0} &lt;music21.note.Note F#&gt;
    {53.0} &lt;music21.note.Note E-&gt;
    {53.75} &lt;music21.note.Note F#&gt;
    {54.75} &lt;music21.note.Rest rest&gt;
</pre></div>
</div>
</div>
</div>
<p>As we can see a single score can take some time to process and analyse.
So before we process every file from our dataset we should take a look at a subset to watch out for any patterns.</p>
<p>Also it is worth making some research so we can reduce the amount of data we need to process.
From the <a class="reference external" href="https://en.wikipedia.org/wiki/General_MIDI#Percussive">wikipedia article on General MIDI (GM)</a> we can see that percussive tracks should be on channel 10.</p>
<p>music21 has <a class="reference external" href="https://web.mit.edu/music21/doc/moduleReference/moduleMidi.html">a build in MIDI library</a> but it is rather difficult and slow to extract the drums using music21 which is why we use <em>pretty_midi</em> for this task.</p>
<p>The <a class="reference external" href="https://web.mit.edu/music21/doc/moduleReference/moduleConverter.html">docs</a> reveal that <code class="docutils literal notranslate"><span class="pre">music21.converter</span></code> seems to be the proper package.</p>
<p>We also start annotating our dataset using <a class="reference external" href="https://pandas.pydata.org/">pandas</a> which is a library for data analysis and manipulation to keep track of any metadata the files have.
Especially the <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.apply.html">apply</a> method comes in handy here as we start with a list of MIDI file paths (see <code class="docutils literal notranslate"><span class="pre">load_midi_df</span></code>) and then we want to extend this list with some information from our MIDI file by applying the <code class="docutils literal notranslate"><span class="pre">parse_midi</span></code> function to all rows of our list.</p>
<p>Additionally we will use <a class="reference external" href="https://en.wikipedia.org/wiki/Cache_(computing)">caching</a> because the meta-analyis of our MIDI files takes about 2 hours on my MacBook.
Caching means that we will store the results on the hard drive so once we calculated them we do not need to re-calculate them because we will just load the files from the hard drive.
It is a common practice in data science to write a function which either loads the data from a file or generates the file we are using as generating or calculating the data is a step which takes often a long time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pretty_midi</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="kn">from</span> <span class="nn">mido</span> <span class="kn">import</span> <span class="n">KeySignatureError</span>
<span class="kn">import</span> <span class="nn">swifter</span>

<span class="k">def</span> <span class="nf">parse_midi</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds information about the MIDI file to a DataFrame row</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">sound</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">PrettyMIDI</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;file_path&#39;</span><span class="p">])</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;midi_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># those are errors that were popping up when the whole dataset was parsed</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="n">KeySignatureError</span><span class="p">,</span> <span class="ne">EOFError</span><span class="p">,</span> <span class="ne">ZeroDivisionError</span><span class="p">):</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;midi_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">row</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;beat_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sound</span><span class="o">.</span><span class="n">estimate_beat_start</span><span class="p">()</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;tempo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sound</span><span class="o">.</span><span class="n">estimate_tempo</span><span class="p">()</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sound</span><span class="o">.</span><span class="n">get_end_time</span><span class="p">()</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;drums&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">is_drum</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sound</span><span class="o">.</span><span class="n">instruments</span><span class="p">])</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sound</span><span class="o">.</span><span class="n">resolution</span>
        <span class="c1"># row[&#39;pitch_class_hist&#39;] = sound.get_pitch_class_histogram()</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;instrument_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sound</span><span class="o">.</span><span class="n">instruments</span><span class="p">]</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;num_time_signature_changes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sound</span><span class="o">.</span><span class="n">time_signature_changes</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># ValueError: Can&#39;t estimate beat start when there are no notes.</span>
        <span class="c1"># ValueError: Can&#39;t provide a global tempo estimate when there are fewer than two notes.</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not parse MIDI file </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;file_path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">row</span>

<span class="k">def</span> <span class="nf">load_midi_df</span><span class="p">(</span>
    <span class="n">save_path</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;midi_df.parquet&#39;</span><span class="p">,</span>
    <span class="n">dataset_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;../datasets/lmd/lmd_full/&#39;</span><span class="p">,</span>
    <span class="n">force_reload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads a dataframe with all available MIDI files in a folder</span>
<span class="sd">    and all </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_reload</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Load dataframe from </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Load data to new dataframe&#39;</span><span class="p">)</span>
    <span class="n">midi_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">,</span> <span class="s1">&#39;*/*.mid&#39;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">midi_files</span><span class="p">)</span><span class="si">}</span><span class="s1"> midi files in folder </span><span class="si">{</span><span class="n">dataset_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="n">midi_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;file_path&#39;</span><span class="p">:</span> <span class="n">midi_files</span><span class="p">})</span>
    <span class="n">midi_df</span> <span class="o">=</span> <span class="n">midi_df</span><span class="o">.</span><span class="n">swifter</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">parse_midi</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">midi_df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saved dataframe in </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">midi_df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span> <span class="o">=</span> <span class="n">load_midi_df</span><span class="p">()</span>
<span class="c1"># select 15 random samples from our list</span>
<span class="n">midi_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Load dataframe from midi_df.parquet
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>beat_start</th>
      <th>drums</th>
      <th>end_time</th>
      <th>file_path</th>
      <th>instrument_names</th>
      <th>midi_error</th>
      <th>num_time_signature_changes</th>
      <th>resolution</th>
      <th>tempo</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>81923</th>
      <td>3.658535</td>
      <td>True</td>
      <td>128.780432</td>
      <td>../datasets/lmd/lmd_full/f/f4b72836981feedb9e1...</td>
      <td>[harmnica, accordn2, drum, acoubass, pianogrd,...</td>
      <td>False</td>
      <td>1.0</td>
      <td>384.0</td>
      <td>175.232953</td>
    </tr>
    <tr>
      <th>171834</th>
      <td>5.399796</td>
      <td>True</td>
      <td>467.992351</td>
      <td>../datasets/lmd/lmd_full/5/53c9399ebac71119904...</td>
      <td>[Flutes, Flutes, Oboes, Oboes, Clarinets, Clar...</td>
      <td>False</td>
      <td>19.0</td>
      <td>192.0</td>
      <td>188.547360</td>
    </tr>
    <tr>
      <th>161502</th>
      <td>0.600000</td>
      <td>False</td>
      <td>38.283333</td>
      <td>../datasets/lmd/lmd_full/2/212f54d7b9e586147c6...</td>
      <td>[Untitled]</td>
      <td>False</td>
      <td>1.0</td>
      <td>480.0</td>
      <td>194.117647</td>
    </tr>
    <tr>
      <th>39942</th>
      <td>4.349159</td>
      <td>True</td>
      <td>254.776049</td>
      <td>../datasets/lmd/lmd_full/6/609b19dde84d2374b7d...</td>
      <td>[S-File, S-File, S-File, S-File, S-File, S-Fil...</td>
      <td>False</td>
      <td>1.0</td>
      <td>384.0</td>
      <td>237.529957</td>
    </tr>
    <tr>
      <th>100593</th>
      <td>4.791044</td>
      <td>False</td>
      <td>190.137078</td>
      <td>../datasets/lmd/lmd_full/d/de4dde0f1e960e41360...</td>
      <td>[, , , , , ]</td>
      <td>False</td>
      <td>0.0</td>
      <td>192.0</td>
      <td>170.384180</td>
    </tr>
    <tr>
      <th>44272</th>
      <td>2.459015</td>
      <td>True</td>
      <td>228.161756</td>
      <td>../datasets/lmd/lmd_full/6/6f74186f4c163863630...</td>
      <td>[drummix, bass, ac piano, Vocal, back voc, ac ...</td>
      <td>False</td>
      <td>1.0</td>
      <td>480.0</td>
      <td>242.119770</td>
    </tr>
    <tr>
      <th>15131</th>
      <td>3.934424</td>
      <td>True</td>
      <td>251.814031</td>
      <td>../datasets/lmd/lmd_full/0/0d8e9c4eb761a3e632b...</td>
      <td>[TAKE ME HOME                    Bextor/Aller/...</td>
      <td>False</td>
      <td>1.0</td>
      <td>96.0</td>
      <td>245.724188</td>
    </tr>
    <tr>
      <th>34735</th>
      <td>17.142852</td>
      <td>False</td>
      <td>340.282369</td>
      <td>../datasets/lmd/lmd_full/6/6d3149b41d088c63627...</td>
      <td>[Voice (Alto), Voice (Alto), Voice (Alto), Pia...</td>
      <td>False</td>
      <td>6.0</td>
      <td>96.0</td>
      <td>84.000025</td>
    </tr>
    <tr>
      <th>45905</th>
      <td>5.994792</td>
      <td>True</td>
      <td>280.114583</td>
      <td>../datasets/lmd/lmd_full/1/1a931072e21340f256b...</td>
      <td>[A.PIANO 1, FINGERDBAS, A.PIANO 1, PAN FLUTE, ...</td>
      <td>False</td>
      <td>1.0</td>
      <td>384.0</td>
      <td>207.446994</td>
    </tr>
    <tr>
      <th>12844</th>
      <td>3.282020</td>
      <td>True</td>
      <td>193.497545</td>
      <td>../datasets/lmd/lmd_full/0/0a7c38887ba4882921e...</td>
      <td>[CANDOMBE, PARA, GARDEL, http://fberni.tripod....</td>
      <td>False</td>
      <td>1.0</td>
      <td>480.0</td>
      <td>224.582071</td>
    </tr>
    <tr>
      <th>114123</th>
      <td>2.792100</td>
      <td>False</td>
      <td>100.750126</td>
      <td>../datasets/lmd/lmd_full/4/455fcb4f4c5ad4d10da...</td>
      <td>[]</td>
      <td>False</td>
      <td>1.0</td>
      <td>1024.0</td>
      <td>153.020774</td>
    </tr>
    <tr>
      <th>14339</th>
      <td>7.961539</td>
      <td>True</td>
      <td>330.377789</td>
      <td>../datasets/lmd/lmd_full/0/029c4baa3089eca3817...</td>
      <td>[, Bass, Bass, Strings, Melodia, Slowstrings, ...</td>
      <td>False</td>
      <td>5.0</td>
      <td>120.0</td>
      <td>199.999987</td>
    </tr>
    <tr>
      <th>131099</th>
      <td>2.538459</td>
      <td>True</td>
      <td>51.692256</td>
      <td>../datasets/lmd/lmd_full/3/353116ea8d2eb4041c9...</td>
      <td>[MIDI Ch. 1, MIDI Ch. 2, MIDI Drums]</td>
      <td>False</td>
      <td>0.0</td>
      <td>96.0</td>
      <td>260.000260</td>
    </tr>
    <tr>
      <th>124606</th>
      <td>9.669701</td>
      <td>True</td>
      <td>273.626126</td>
      <td>../datasets/lmd/lmd_full/3/3574baf9f9cdfa4c3e1...</td>
      <td>[Rhodes Piano, Synth Bass H, Synth Bass L, Aco...</td>
      <td>False</td>
      <td>1.0</td>
      <td>120.0</td>
      <td>207.262310</td>
    </tr>
    <tr>
      <th>136078</th>
      <td>8.405307</td>
      <td>True</td>
      <td>217.860027</td>
      <td>../datasets/lmd/lmd_full/e/eb59c9f6854d897a03a...</td>
      <td>[Bass / Acoustic bass, Piano / Rhodes, Melody ...</td>
      <td>False</td>
      <td>1.0</td>
      <td>240.0</td>
      <td>193.775528</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Lets also attach the information about the possible file names.
A problem we observe here is that we have many possible file names for a single cryptic filename - this is called a <em>1:n</em> relationship and it is not best practice to put such a relation into one dataframe but for now we will do this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_names_loop</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
    <span class="c1"># we do not use apply as it consumes more memory and</span>
    <span class="c1"># takes a bit longer</span>
    <span class="n">original_names</span><span class="p">,</span> <span class="n">num_names</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">md5_hash</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;file_path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">md5_filenames</span><span class="p">[</span><span class="n">md5_hash</span><span class="p">]</span>
        <span class="n">original_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
        <span class="n">num_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">))</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;original_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">original_names</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;num_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_names</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="n">add_names_loop</span><span class="p">(</span><span class="n">midi_df</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>beat_start</th>
      <th>drums</th>
      <th>end_time</th>
      <th>file_path</th>
      <th>instrument_names</th>
      <th>midi_error</th>
      <th>num_time_signature_changes</th>
      <th>resolution</th>
      <th>tempo</th>
      <th>original_names</th>
      <th>num_names</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.818180</td>
      <td>True</td>
      <td>22.599409</td>
      <td>../datasets/lmd/lmd_full/9/9fcfccf1c2245c74eb0...</td>
      <td>[, , , , , , , ]</td>
      <td>False</td>
      <td>1.0</td>
      <td>384.0</td>
      <td>239.659814</td>
      <td>[Sure.Polyphone.Midi/Poly 1496.mid, Sure.Polyp...</td>
      <td>11</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.904761</td>
      <td>False</td>
      <td>26.126684</td>
      <td>../datasets/lmd/lmd_full/9/9daedd9c5a390069a9c...</td>
      <td>[reFX Nexus #2 (MIDI)]</td>
      <td>False</td>
      <td>0.0</td>
      <td>96.0</td>
      <td>220.500143</td>
      <td>[W/Wildstylez_-_Pleasure_(Original_Mix)__kisga...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.230769</td>
      <td>False</td>
      <td>188.999402</td>
      <td>../datasets/lmd/lmd_full/9/94078e08bc697e5ec56...</td>
      <td>[]</td>
      <td>False</td>
      <td>2.0</td>
      <td>256.0</td>
      <td>253.787091</td>
      <td>[Classical_Guitar_classicalguitarmidi.com_MIDI...</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>../datasets/lmd/lmd_full/9/911cd08fa1fae36e5e0...</td>
      <td>None</td>
      <td>True</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>[s/sou.mid, S/sou.mid]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.095833</td>
      <td>False</td>
      <td>6.475000</td>
      <td>../datasets/lmd/lmd_full/9/9d37fb70bc6886e3987...</td>
      <td>[MIDI out]</td>
      <td>False</td>
      <td>0.0</td>
      <td>96.0</td>
      <td>214.285714</td>
      <td>[S/Sj - I Need U.mid]</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Lets examine the extracted metadata of those files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">midi_error</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Number of faulty MIDI files&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_24_0.png" src="../_images/01_midi_drums_24_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">drums</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Number of MIDI files that contain drums&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_25_0.png" src="../_images/01_midi_drums_25_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">end_time</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">vert</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_26_0.png" src="../_images/01_midi_drums_26_0.png" />
</div>
</div>
<p>We see that the <code class="docutils literal notranslate"><span class="pre">end_time</span></code> has some extreme values that are probably wrong - lets inspect those examples closer to see if we can see a pattern.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;end_time&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>beat_start</th>
      <th>drums</th>
      <th>end_time</th>
      <th>file_path</th>
      <th>instrument_names</th>
      <th>midi_error</th>
      <th>num_time_signature_changes</th>
      <th>resolution</th>
      <th>tempo</th>
      <th>original_names</th>
      <th>num_names</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>84737</th>
      <td>0.468750</td>
      <td>False</td>
      <td>31055.625000</td>
      <td>../datasets/lmd/lmd_full/f/f7b41341a20201f860c...</td>
      <td>[Melody, On the Sun Road, Vivian Lai, Joseph L...</td>
      <td>False</td>
      <td>2.0</td>
      <td>120.0</td>
      <td>225.041860</td>
      <td>[s/sunroad.mid, S/sunroad.mid]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>28204</th>
      <td>0.352941</td>
      <td>True</td>
      <td>25714.187790</td>
      <td>../datasets/lmd/lmd_full/7/7abab3566b77073f827...</td>
      <td>[, , , , , , , ]</td>
      <td>False</td>
      <td>9.0</td>
      <td>96.0</td>
      <td>220.109820</td>
      <td>[FErnszt/Olala.mid]</td>
      <td>1</td>
    </tr>
    <tr>
      <th>69901</th>
      <td>1.263156</td>
      <td>True</td>
      <td>20384.791244</td>
      <td>../datasets/lmd/lmd_full/a/af6b689cfbb13c302bd...</td>
      <td>[Acoustic Bass, Brass, Grand piano, Rock Organ...</td>
      <td>False</td>
      <td>7.0</td>
      <td>96.0</td>
      <td>229.041171</td>
      <td>[FErnszt/Swingin.mid]</td>
      <td>1</td>
    </tr>
    <tr>
      <th>26973</th>
      <td>1.444671</td>
      <td>True</td>
      <td>19652.447880</td>
      <td>../datasets/lmd/lmd_full/7/73f4f536d3d42293bd7...</td>
      <td>[tk1, tk2, tk3, tk4, tk10, tk11]</td>
      <td>False</td>
      <td>1.0</td>
      <td>192.0</td>
      <td>144.311366</td>
      <td>[Clapton Eric/Bellbottom Blues.mid, Various Ar...</td>
      <td>10</td>
    </tr>
    <tr>
      <th>24515</th>
      <td>1.016603</td>
      <td>True</td>
      <td>19623.803343</td>
      <td>../datasets/lmd/lmd_full/7/7486b07d9a4060fa614...</td>
      <td>[Steel Str.Guitar, Fretless Bass, Piano, Violi...</td>
      <td>False</td>
      <td>13.0</td>
      <td>192.0</td>
      <td>181.059483</td>
      <td>[K/Kevin Parent Les Doigts 2.mid]</td>
      <td>1</td>
    </tr>
    <tr>
      <th>47026</th>
      <td>31.153327</td>
      <td>True</td>
      <td>18872.905893</td>
      <td>../datasets/lmd/lmd_full/1/15be4e0d9a337fbcc76...</td>
      <td>[, , , , , , , , , , , , , , ]</td>
      <td>False</td>
      <td>1.0</td>
      <td>120.0</td>
      <td>216.170531</td>
      <td>[L/Les Lacs Du Conemara.mid]</td>
      <td>1</td>
    </tr>
    <tr>
      <th>129390</th>
      <td>31.153327</td>
      <td>True</td>
      <td>18872.905893</td>
      <td>../datasets/lmd/lmd_full/3/3f981f6caf64d373e11...</td>
      <td>[, , , , , , , , , , , , , , ]</td>
      <td>False</td>
      <td>1.0</td>
      <td>120.0</td>
      <td>216.170531</td>
      <td>[L/Les Lacs Du Connemara Michel Sardou.mid]</td>
      <td>1</td>
    </tr>
    <tr>
      <th>52962</th>
      <td>0.410958</td>
      <td>False</td>
      <td>15717.097325</td>
      <td>../datasets/lmd/lmd_full/1/1880f0001f6c5bd6c69...</td>
      <td>[, , , , , ]</td>
      <td>False</td>
      <td>1.0</td>
      <td>192.0</td>
      <td>263.729424</td>
      <td>[Diversen Klassiek/DR_G.MID, D/DR_G.MID]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>81576</th>
      <td>0.677083</td>
      <td>True</td>
      <td>15491.909440</td>
      <td>../datasets/lmd/lmd_full/f/fce329e7539459a23e4...</td>
      <td>[A. Bass, Clas. Guit, A. Guitar, OPCIONAL, (Ma...</td>
      <td>False</td>
      <td>3.0</td>
      <td>384.0</td>
      <td>179.936115</td>
      <td>[p/piensami.mid, P/piensami.mid]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>65135</th>
      <td>3.044301</td>
      <td>True</td>
      <td>14337.531639</td>
      <td>../datasets/lmd/lmd_full/8/876255a805247c5fca2...</td>
      <td>[, , , , , , , ]</td>
      <td>False</td>
      <td>1.0</td>
      <td>120.0</td>
      <td>190.305001</td>
      <td>[Diversen Kerst Muziek Traditional/O-Little-To...</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Regarding this it seems we should filter out those really long pieces as those are most probably wrong files.</p>
<p>Those errors could be caused by our parsing or by the MIDI files itself - but as we have a big enough corpora it is justifiable by not including those outliers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">beat_start</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">vert</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_30_0.png" src="../_images/01_midi_drums_30_0.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">beat_start</span></code> looks ok, although we also should include some filtering here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">tempo</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">vert</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_32_0.png" src="../_images/01_midi_drums_32_0.png" />
</div>
</div>
<p>It is interesting to see that 95% of our examples are in the 200 bpm range - maybe they were transcribed in half time or we have a skewed dataset towards fast music which would be an interesting exploration what kind of music gets transcribed to MIDI files.</p>
<p>We need to inspect this further as drumming is closely related to the tempo of a song and we do not want to interpret the massive amount of data in a wrong way.</p>
<p>It is important to have an understanding and feeling for the data.
We have an expectation of our data which can help us to see if the data makes sense and if we parsed it correctly but can also always be problematic because we project certain expectations on an projection and simplification of our data.</p>
<p><strong>TODO</strong> Flesh this out</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">resolution</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">vert</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_34_0.png" src="../_images/01_midi_drums_34_0.png" />
</div>
</div>
<p>Resolution corresponds to the <a class="reference external" href="https://en.wikipedia.org/wiki/Pulses_per_quarter_note">PPQN</a> of the MIDI file.
Everything above 1000 should be suspicious, so lets take a look at those examples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;resolution&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>beat_start</th>
      <th>drums</th>
      <th>end_time</th>
      <th>file_path</th>
      <th>instrument_names</th>
      <th>midi_error</th>
      <th>num_time_signature_changes</th>
      <th>resolution</th>
      <th>tempo</th>
      <th>original_names</th>
      <th>num_names</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>33871</th>
      <td>2.000000</td>
      <td>False</td>
      <td>135.368840</td>
      <td>../datasets/lmd/lmd_full/6/610987ebaf0a326db40...</td>
      <td>[, , , ]</td>
      <td>False</td>
      <td>1.0</td>
      <td>25000.0</td>
      <td>239.221606</td>
      <td>[b/beethovenalladanza.mid, B/beethovenalladanz...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>45187</th>
      <td>1.071428</td>
      <td>True</td>
      <td>79.280092</td>
      <td>../datasets/lmd/lmd_full/1/1283eddbc4ab9042dcc...</td>
      <td>[, , ]</td>
      <td>False</td>
      <td>1.0</td>
      <td>24576.0</td>
      <td>225.608072</td>
      <td>[Pop_and_Top40/2 Pac - Changes.mid, Pop_and_To...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>67351</th>
      <td>0.250000</td>
      <td>False</td>
      <td>26.987488</td>
      <td>../datasets/lmd/lmd_full/a/a5c6eb45c94d84474cb...</td>
      <td>[, , ]</td>
      <td>False</td>
      <td>2.0</td>
      <td>16384.0</td>
      <td>235.213491</td>
      <td>[a/amigo3.mid, A/amigo3.mid]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>38884</th>
      <td>0.642857</td>
      <td>False</td>
      <td>13.071416</td>
      <td>../datasets/lmd/lmd_full/6/63ecd58c3d030790cd9...</td>
      <td>[A Step Too Far]</td>
      <td>False</td>
      <td>1.0</td>
      <td>15360.0</td>
      <td>227.500228</td>
      <td>[R/Refresh_-_A_Step_Too_Far__DJ_Exprice_200809...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3838</th>
      <td>1.499999</td>
      <td>False</td>
      <td>13.714272</td>
      <td>../datasets/lmd/lmd_full/9/9f0df0be6a30b48a7a2...</td>
      <td>[SubTractor 1]</td>
      <td>False</td>
      <td>1.0</td>
      <td>15360.0</td>
      <td>246.400246</td>
      <td>[S/Svenrg Vs Bass T - The Sign (Pulsedriver Vs...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>59166</th>
      <td>14.014592</td>
      <td>False</td>
      <td>28.029184</td>
      <td>../datasets/lmd/lmd_full/8/80013e388373fca6ca3...</td>
      <td>[Strings]</td>
      <td>False</td>
      <td>1.0</td>
      <td>15360.0</td>
      <td>51.375024</td>
      <td>[F/ferry_corsten__everything_goes__tmf_awards_...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>146384</th>
      <td>0.671642</td>
      <td>False</td>
      <td>7.059232</td>
      <td>../datasets/lmd/lmd_full/b/b95c22e47fb3dc8855a...</td>
      <td>[MELODY, BASSLINE]</td>
      <td>False</td>
      <td>1.0</td>
      <td>15360.0</td>
      <td>268.000116</td>
      <td>[D/Decoy_And_Roy_-_Innerlife__DJRenco_Sam_Cera...</td>
      <td>1</td>
    </tr>
    <tr>
      <th>112102</th>
      <td>1.521737</td>
      <td>False</td>
      <td>6.847817</td>
      <td>../datasets/lmd/lmd_full/4/477fed40eecc0fd5051...</td>
      <td>[Matel disco music maker, Bass, Stylophone 1, ...</td>
      <td>False</td>
      <td>1.0</td>
      <td>15360.0</td>
      <td>276.000386</td>
      <td>[K/Kraftwerk_-_Dentaku__RueArsins_201302032206...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>92169</th>
      <td>1.655172</td>
      <td>False</td>
      <td>13.237066</td>
      <td>../datasets/lmd/lmd_full/c/c3e63f5d16ed5a7124a...</td>
      <td>[2 Best Enemies - Phases]</td>
      <td>False</td>
      <td>1.0</td>
      <td>15360.0</td>
      <td>213.126196</td>
      <td>[2/2_Best_Enemies_-_Phases_(TBY_Romantic_Mix)_...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>175242</th>
      <td>1.499999</td>
      <td>False</td>
      <td>27.428544</td>
      <td>../datasets/lmd/lmd_full/5/5e35a0ca0be796095f8...</td>
      <td>[NN-XT 1, NN19 1, SubTractor 1]</td>
      <td>False</td>
      <td>1.0</td>
      <td>15360.0</td>
      <td>280.000280</td>
      <td>[D/Dusterix - Dusted (CJ Stone Mix).mid]</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="p">[</span><span class="s1">&#39;num_time_signature_changes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">vert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">logx</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_37_0.png" src="../_images/01_midi_drums_37_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;num_time_signature_changes&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>beat_start</th>
      <th>drums</th>
      <th>end_time</th>
      <th>file_path</th>
      <th>instrument_names</th>
      <th>midi_error</th>
      <th>num_time_signature_changes</th>
      <th>resolution</th>
      <th>tempo</th>
      <th>original_names</th>
      <th>num_names</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>72284</th>
      <td>5.862357</td>
      <td>True</td>
      <td>204.310165</td>
      <td>../datasets/lmd/lmd_full/a/a85612fb0992100bded...</td>
      <td>[STRAUSS, STRAUSS, STRAUSS, STRAUSS, STRAUSS, ...</td>
      <td>False</td>
      <td>959.0</td>
      <td>48.0</td>
      <td>222.143725</td>
      <td>[S/STRAUSS.MID, S/STRAUSS.MID]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>26776</th>
      <td>6.629205</td>
      <td>True</td>
      <td>229.441685</td>
      <td>../datasets/lmd/lmd_full/7/7d42a95293cc47bcacf...</td>
      <td>[NACHT, NACHT, NACHT, NACHT, NACHT, NACHT, NACHT]</td>
      <td>False</td>
      <td>782.0</td>
      <td>48.0</td>
      <td>199.481296</td>
      <td>[Hollands/NACHT.MID]</td>
      <td>1</td>
    </tr>
    <tr>
      <th>168045</th>
      <td>3.304224</td>
      <td>True</td>
      <td>255.266272</td>
      <td>../datasets/lmd/lmd_full/5/5693291bc82548fea37...</td>
      <td>[VIBRA SLAP, VIBRA SLAP, VIBRA SLAP, VIBRA SLA...</td>
      <td>False</td>
      <td>479.0</td>
      <td>96.0</td>
      <td>242.258977</td>
      <td>[S/Striving.MID, Midis Diversas/STRIVING.MID, ...</td>
      <td>3</td>
    </tr>
    <tr>
      <th>60293</th>
      <td>5.500000</td>
      <td>False</td>
      <td>283.476487</td>
      <td>../datasets/lmd/lmd_full/8/85b2d4e8637008f6b4e...</td>
      <td>[, ]</td>
      <td>False</td>
      <td>424.0</td>
      <td>1024.0</td>
      <td>218.486679</td>
      <td>[B/beevar2.mid]</td>
      <td>1</td>
    </tr>
    <tr>
      <th>44034</th>
      <td>1.550000</td>
      <td>False</td>
      <td>407.079384</td>
      <td>../datasets/lmd/lmd_full/6/69df67cd25dd33c1217...</td>
      <td>[, ]</td>
      <td>False</td>
      <td>382.0</td>
      <td>1024.0</td>
      <td>228.828269</td>
      <td>[Schumann/Schuman Toccata op7.mid, Schumann/Sc...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>93896</th>
      <td>4.500000</td>
      <td>False</td>
      <td>785.261142</td>
      <td>../datasets/lmd/lmd_full/c/cf1767440a9e43e7193...</td>
      <td>[© 1996, © 1996]</td>
      <td>False</td>
      <td>381.0</td>
      <td>1024.0</td>
      <td>196.251518</td>
      <td>[S/Sonata - C.MID, Midis Diversas/SONATA - C.M...</td>
      <td>3</td>
    </tr>
    <tr>
      <th>89587</th>
      <td>5.500000</td>
      <td>True</td>
      <td>2630.747499</td>
      <td>../datasets/lmd/lmd_full/c/c0caac5c8affb877d36...</td>
      <td>[Vocals, Vocals, Vocals, Vocals, Sax &amp; Flute, ...</td>
      <td>False</td>
      <td>349.0</td>
      <td>192.0</td>
      <td>207.477311</td>
      <td>[Jethro-Tull/a passion.mid]</td>
      <td>1</td>
    </tr>
    <tr>
      <th>121888</th>
      <td>1.909089</td>
      <td>False</td>
      <td>1340.480446</td>
      <td>../datasets/lmd/lmd_full/4/441c229736ca265a78b...</td>
      <td>[Grand Piano, Instrument17, Instrument18, Inst...</td>
      <td>False</td>
      <td>345.0</td>
      <td>120.0</td>
      <td>165.797267</td>
      <td>[Schubert/Valses Sentimentales op50 D779.mid, ...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>163342</th>
      <td>3.333332</td>
      <td>True</td>
      <td>336.817954</td>
      <td>../datasets/lmd/lmd_full/2/2021875aa51e2374eb5...</td>
      <td>[Channel 10 Hi-Hats, Channel 10 Hi-Hats, Chann...</td>
      <td>False</td>
      <td>300.0</td>
      <td>96.0</td>
      <td>231.269832</td>
      <td>[S/Swept Away.mid, Midis Diversas/swept away.m...</td>
      <td>3</td>
    </tr>
    <tr>
      <th>26387</th>
      <td>8.155336</td>
      <td>False</td>
      <td>621.914434</td>
      <td>../datasets/lmd/lmd_full/7/79cc201f43cb9fba7e6...</td>
      <td>[, ]</td>
      <td>False</td>
      <td>296.0</td>
      <td>1024.0</td>
      <td>195.007038</td>
      <td>[B/beevar1.mid]</td>
      <td>1</td>
    </tr>
    <tr>
      <th>172851</th>
      <td>2.384100</td>
      <td>False</td>
      <td>311.196005</td>
      <td>../datasets/lmd/lmd_full/5/526e17017303fc5bbc1...</td>
      <td>[, , ]</td>
      <td>False</td>
      <td>278.0</td>
      <td>1024.0</td>
      <td>179.377942</td>
      <td>[P/pagavar9.mid]</td>
      <td>1</td>
    </tr>
    <tr>
      <th>93577</th>
      <td>1.764705</td>
      <td>False</td>
      <td>197.860502</td>
      <td>../datasets/lmd/lmd_full/c/c883d35b66bbe8e9fb9...</td>
      <td>[, ]</td>
      <td>False</td>
      <td>278.0</td>
      <td>1024.0</td>
      <td>183.250619</td>
      <td>[Bartok/Unknown Piano Sonata Mov.3.mid, Bartok...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>37475</th>
      <td>1.421050</td>
      <td>False</td>
      <td>261.473292</td>
      <td>../datasets/lmd/lmd_full/6/6c605d6883a3968e79d...</td>
      <td>[Instrument 1, Instrument2, Instrument3, Instr...</td>
      <td>False</td>
      <td>276.0</td>
      <td>1024.0</td>
      <td>190.000285</td>
      <td>[d/dance8.mid, D/dance8.mid]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>7226</th>
      <td>3.692304</td>
      <td>False</td>
      <td>507.230262</td>
      <td>../datasets/lmd/lmd_full/9/9b8851148b17284c11e...</td>
      <td>[Ken's Stuff, © 1996]</td>
      <td>False</td>
      <td>275.0</td>
      <td>1024.0</td>
      <td>229.009078</td>
      <td>[n/night-3.mid, N/night-3.mid]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>16617</th>
      <td>2.107142</td>
      <td>False</td>
      <td>232.490176</td>
      <td>../datasets/lmd/lmd_full/0/0c98c404a173d2ae168...</td>
      <td>[, ]</td>
      <td>False</td>
      <td>267.0</td>
      <td>1024.0</td>
      <td>274.023321</td>
      <td>[t/tocatacl.mid, T/tocatacl.mid]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>157624</th>
      <td>2.307690</td>
      <td>False</td>
      <td>243.575424</td>
      <td>../datasets/lmd/lmd_full/2/2f5ba581b764e82e991...</td>
      <td>[, ]</td>
      <td>False</td>
      <td>266.0</td>
      <td>1024.0</td>
      <td>234.355089</td>
      <td>[Bartok/Unknown Piano Sonata Mov.1.mid, Bartok...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>101824</th>
      <td>1.714284</td>
      <td>True</td>
      <td>651.247812</td>
      <td>../datasets/lmd/lmd_full/d/d93e70ee04dec17d544...</td>
      <td>[Acoustic Bass, Flute, String Ensemble 1, Stri...</td>
      <td>False</td>
      <td>261.0</td>
      <td>1024.0</td>
      <td>186.672066</td>
      <td>[r/rhapsody05.mid, R/rhapsody05.mid]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>116874</th>
      <td>0.902254</td>
      <td>False</td>
      <td>235.054588</td>
      <td>../datasets/lmd/lmd_full/4/412b3106915479daf12...</td>
      <td>[, , , ]</td>
      <td>False</td>
      <td>259.0</td>
      <td>1024.0</td>
      <td>254.599908</td>
      <td>[Rachmaninov/Paganini variations.mid, Rachmani...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>14333</th>
      <td>0.757575</td>
      <td>False</td>
      <td>285.805082</td>
      <td>../datasets/lmd/lmd_full/0/01e682c8e1a7dd5b0b7...</td>
      <td>[]</td>
      <td>False</td>
      <td>256.0</td>
      <td>1024.0</td>
      <td>231.400347</td>
      <td>[d/deb8.mid, D/deb8.mid]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>13465</th>
      <td>1.571427</td>
      <td>False</td>
      <td>105.217389</td>
      <td>../datasets/lmd/lmd_full/0/02a4ab472b9071825a3...</td>
      <td>[]</td>
      <td>False</td>
      <td>227.0</td>
      <td>1024.0</td>
      <td>182.965443</td>
      <td>[Classical Archives - The Greats (MIDI)/Bartok...</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We observe that some tracks have an excessive amount of time signature changes.
Some such as <em>Money</em> by <em>Pink Floyd</em> can be explained by the <span class="math notranslate nohighlight">\(\frac{7}{4}\)</span> time signature which can also be written as an alternating between <span class="math notranslate nohighlight">\(\frac{3}{4}\)</span> and <span class="math notranslate nohighlight">\(\frac{4}{4}\)</span>.
To keep things simple for now we should maybe allow only songs without any time signature change.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">midi_df</span><span class="o">.</span><span class="n">num_time_signature_changes</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pie</span><span class="p">();</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Tracks without time signature changes&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_40_0.png" src="../_images/01_midi_drums_40_0.png" />
</div>
</div>
<p>We can also take a look at the most common instrument names in our dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;instrument_names&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">instrument_names</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  354674
Bass               29531
Drums              19437
untitled           18471
Piano              16342
Strings            10923
Soprano            10478
Guitar             10126
Alto                9368
Tenor               8987
DRUMS               8014
Melody              6693
WinJammer Demo      6488
Voice               6270
Piano (hi)          4905
Piano (lo)          4900
Italian             4679
STRINGS             4003
bass                3785
MELODY              3775
Name: instrument_names, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>And also take a look at the most common names of our original filenames.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;num_names&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>beat_start</th>
      <th>drums</th>
      <th>end_time</th>
      <th>file_path</th>
      <th>instrument_names</th>
      <th>midi_error</th>
      <th>num_time_signature_changes</th>
      <th>resolution</th>
      <th>tempo</th>
      <th>original_names</th>
      <th>num_names</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>105645</th>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>../datasets/lmd/lmd_full/d/d41d8cd98f00b204e98...</td>
      <td>None</td>
      <td>True</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>[Mccartney Paul/Bluebird Paul and Linda Mccart...</td>
      <td>505</td>
    </tr>
    <tr>
      <th>140258</th>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>../datasets/lmd/lmd_full/e/ea1346344936b7397f2...</td>
      <td>None</td>
      <td>True</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>[Sure.Polyphone.Midi/Hangon.MID, Sure.Polyphon...</td>
      <td>116</td>
    </tr>
    <tr>
      <th>3815</th>
      <td>1.500000</td>
      <td>True</td>
      <td>149.996094</td>
      <td>../datasets/lmd/lmd_full/9/98b7b924eb5c5fcfbd6...</td>
      <td>[Organ 3 Lead, Organ 3 Harmony, Harmonica, Nyl...</td>
      <td>False</td>
      <td>1.0</td>
      <td>96.0</td>
      <td>232.563380</td>
      <td>[Sure.Polyphone.Midi/Love Me Do.mid, l/loveme0...</td>
      <td>73</td>
    </tr>
    <tr>
      <th>137550</th>
      <td>0.000000</td>
      <td>True</td>
      <td>368.695560</td>
      <td>../datasets/lmd/lmd_full/e/e651708cb4e24e60a5b...</td>
      <td>[Vocals, Guitar 1, Guitar 2, Guitar 3, Guitar ...</td>
      <td>False</td>
      <td>13.0</td>
      <td>120.0</td>
      <td>238.815999</td>
      <td>[U/Unforgiven 2.mid, t/theunforgiven2.mid, Met...</td>
      <td>68</td>
    </tr>
    <tr>
      <th>40890</th>
      <td>4.210520</td>
      <td>True</td>
      <td>263.157500</td>
      <td>../datasets/lmd/lmd_full/6/697d99bf3aee8effc28...</td>
      <td>[, , , , , , , , , , , , , , ]</td>
      <td>False</td>
      <td>2.0</td>
      <td>192.0</td>
      <td>228.715629</td>
      <td>[VARIOUS/U 2 - Don`t You Forget Me.mid, D/Don'...</td>
      <td>67</td>
    </tr>
    <tr>
      <th>13452</th>
      <td>0.638298</td>
      <td>True</td>
      <td>239.973452</td>
      <td>../datasets/lmd/lmd_full/0/05607e50402c0bb1a8a...</td>
      <td>[Percussion, Percussion, Bass, High synth, Flu...</td>
      <td>False</td>
      <td>1.0</td>
      <td>120.0</td>
      <td>189.167664</td>
      <td>[Sure.Polyphone.Midi/Dr - Dre.MID, Sure.Polyph...</td>
      <td>62</td>
    </tr>
    <tr>
      <th>35183</th>
      <td>3.157890</td>
      <td>True</td>
      <td>147.484755</td>
      <td>../datasets/lmd/lmd_full/6/675fe9788c44ef27d3d...</td>
      <td>[Fretless Bass, Lead Flute, Aah Double, Ooh 1,...</td>
      <td>False</td>
      <td>7.0</td>
      <td>96.0</td>
      <td>181.250133</td>
      <td>[A/Atasteofhoney.mid, a/atasteof.mid, Beatles,...</td>
      <td>59</td>
    </tr>
    <tr>
      <th>90521</th>
      <td>2.536842</td>
      <td>True</td>
      <td>193.159651</td>
      <td>../datasets/lmd/lmd_full/c/c507304afe6cddba192...</td>
      <td>[Flute, Synth Bass, Synth Bass 2, Orch Hit, Ef...</td>
      <td>False</td>
      <td>1.0</td>
      <td>120.0</td>
      <td>206.513514</td>
      <td>[Sure.Polyphone.Midi/15.mid, m/mission-g-g.mid...</td>
      <td>59</td>
    </tr>
    <tr>
      <th>18774</th>
      <td>3.485049</td>
      <td>True</td>
      <td>121.956351</td>
      <td>../datasets/lmd/lmd_full/0/07f7181fb5ff6e87cd6...</td>
      <td>[, , , , , , , ]</td>
      <td>False</td>
      <td>1.0</td>
      <td>192.0</td>
      <td>201.848937</td>
      <td>[BeachBoys/Pleasepleaseme.mid, p/please3.mid, ...</td>
      <td>58</td>
    </tr>
    <tr>
      <th>62115</th>
      <td>4.950000</td>
      <td>True</td>
      <td>164.699980</td>
      <td>../datasets/lmd/lmd_full/8/88666265d8e30cf7ef1...</td>
      <td>[Fretless E.Bass, Nylon Gtr, Rock Org Lead, Oo...</td>
      <td>False</td>
      <td>1.0</td>
      <td>96.0</td>
      <td>208.075417</td>
      <td>[BeachBoys/Doyouwanttoknowasecret.mid, s/secre...</td>
      <td>57</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;original_names&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">original_names</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[^a-zA-Z]&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              1091324
mid            570786
midi            56765
various         42479
artists         36610
a               34883
the             34148
l               29181
s               28479
polyphone       24771
sure            23089
i               22765
m               20958
e               20792
t               19164
midis           19014
c               18162
b               17950
d               17712
n               17012
h               15452
o               15425
g               13303
you             13228
p               12267
k               12032
of              11890
poly            11836
in              11073
f               10433
beatles          9696
love             9246
r                8911
me               8901
j                8816
diversen         8643
my               8172
to               7585
divers           7025
w                6894
analisadas       6320
no               6073
de               5601
on               5373
and              5349
midirip          5017
it               4853
bach             4692
classical        4542
unsorted         4419
Name: original_names, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>An interesting aspect of this analyis reveals that the most common words in a text corpora do not often contain much information what the text is about because the grammar structure of the text introduces noise to the dataset.</p>
<p>There are basic algorithms such as <a class="reference external" href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf">tf-idf</a> which allows us to filter out the noise by asserting that a word which is common in many documents has little to no meaning (e.g. <em>the</em> or in our case <em>midi</em>) and therefore give it a low score.
Although if a significant subset of our file names contain a word that is not so common in the other file names (e.g. <em>beatles</em>) this <em>token</em> will receive a high rating.</p>
<p>For now we dont want to inspect this further but its always good to know such kind of algorithms as it helps to filter out the relevant data.</p>
<p>Its also good to make some sanity checks on our data.
One assumption would be that every file in which we did not detect a drum track also does not contain an instrument with the name <em>drums</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">explodeded_df</span> <span class="o">=</span> <span class="n">midi_df</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;instrument_names&#39;</span><span class="p">)</span>
<span class="n">explodeded_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">explodeded_df</span><span class="p">[</span><span class="s1">&#39;instrument_names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;drums&#39;</span><span class="p">,</span> <span class="s1">&#39;drum&#39;</span><span class="p">]))</span><span class="o">&amp;</span>
    <span class="p">(</span><span class="n">explodeded_df</span><span class="p">[</span><span class="s1">&#39;drums&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;file_path&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>file_path</th>
      <th>beat_start</th>
      <th>drums</th>
      <th>end_time</th>
      <th>instrument_names</th>
      <th>midi_error</th>
      <th>num_time_signature_changes</th>
      <th>resolution</th>
      <th>tempo</th>
      <th>original_names</th>
      <th>num_names</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>../datasets/lmd/lmd_full/0/0093ffc81428aabfa14...</td>
      <td>2.210523</td>
      <td>False</td>
      <td>137.151110</td>
      <td>Drums</td>
      <td>False</td>
      <td>1.0</td>
      <td>192.0</td>
      <td>190.000285</td>
      <td>[M/Martha My Dear 3.mid, Beatles +GeorgeJohnPa...</td>
      <td>15</td>
    </tr>
    <tr>
      <th>1</th>
      <td>../datasets/lmd/lmd_full/0/032e298d9560fdbe954...</td>
      <td>4.423678</td>
      <td>False</td>
      <td>114.947196</td>
      <td>Drums</td>
      <td>False</td>
      <td>1.0</td>
      <td>120.0</td>
      <td>120.000180</td>
      <td>[s/smetmoth.mid, S/smetmoth.mid]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>../datasets/lmd/lmd_full/0/043e1c01e58a4bb4499...</td>
      <td>18.071422</td>
      <td>False</td>
      <td>196.778591</td>
      <td>Drums</td>
      <td>False</td>
      <td>1.0</td>
      <td>120.0</td>
      <td>139.999977</td>
      <td>[Songs+300/Tunnel_o.mid]</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>../datasets/lmd/lmd_full/0/06f86377b1dbad0ebf0...</td>
      <td>1.000000</td>
      <td>False</td>
      <td>59.483692</td>
      <td>DRUMS</td>
      <td>False</td>
      <td>1.0</td>
      <td>192.0</td>
      <td>226.482465</td>
      <td>[s/seaquest2.mid, S/seaquest2.mid]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>../datasets/lmd/lmd_full/0/078e2cc7c46eb5de726...</td>
      <td>1.224488</td>
      <td>False</td>
      <td>281.211322</td>
      <td>Drums</td>
      <td>False</td>
      <td>1.0</td>
      <td>192.0</td>
      <td>204.052854</td>
      <td>[Pop/SLEGDEHM.MID, PeterGabriel/Sledgehammer6....</td>
      <td>4</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>148</th>
      <td>../datasets/lmd/lmd_full/f/f2a97c0f7fa26244a77...</td>
      <td>11.999988</td>
      <td>False</td>
      <td>213.553358</td>
      <td>drums</td>
      <td>False</td>
      <td>1.0</td>
      <td>192.0</td>
      <td>218.459582</td>
      <td>[u/unchainedmelody3.mid, U/UnchainedMelody3.mid]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>149</th>
      <td>../datasets/lmd/lmd_full/f/f6702b2445a6ce9aa8e...</td>
      <td>1.066667</td>
      <td>False</td>
      <td>21.241667</td>
      <td>Drums</td>
      <td>False</td>
      <td>1.0</td>
      <td>480.0</td>
      <td>211.143695</td>
      <td>[e/ElectroJam.Mid, E/ElectroJam.Mid]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>150</th>
      <td>../datasets/lmd/lmd_full/f/f8a56c3ebc00bfef70d...</td>
      <td>6.000000</td>
      <td>False</td>
      <td>263.847656</td>
      <td>Drums</td>
      <td>False</td>
      <td>1.0</td>
      <td>192.0</td>
      <td>157.793103</td>
      <td>[t/tearinhand.mid, T/tearinhand.mid]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>151</th>
      <td>../datasets/lmd/lmd_full/f/fa06799e6825c6a4095...</td>
      <td>8.053700</td>
      <td>False</td>
      <td>383.315852</td>
      <td>drums</td>
      <td>False</td>
      <td>16.0</td>
      <td>240.0</td>
      <td>284.928064</td>
      <td>[l/louder.mid, L/louder.mid]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>152</th>
      <td>../datasets/lmd/lmd_full/f/fd37e5d1258ba97fc0e...</td>
      <td>0.610000</td>
      <td>False</td>
      <td>191.795000</td>
      <td>Drums</td>
      <td>False</td>
      <td>1.0</td>
      <td>120.0</td>
      <td>235.685752</td>
      <td>[Christian/Easyway.mid, Various Artists/easywa...</td>
      <td>11</td>
    </tr>
  </tbody>
</table>
<p>153 rows × 11 columns</p>
</div></div></div>
</div>
<p>Listening to those examples reveal that some of them use another instrument than drums for their drums - either by artistic choice or by mistake.
As this only applies to 32 files we can live with this error and ignore the files were we did not detect the drum track.</p>
</div>
<div class="section" id="filter-and-extract-the-data">
<h2>Filter and extract the data<a class="headerlink" href="#filter-and-extract-the-data" title="Permalink to this headline">¶</a></h2>
<p>After inspecting all availabe files we should filter out some <em>noisy</em> files that are either not interesting to us (they lack a drum track) or the parsing of the MIDI files did not work as expected.
With the analysis above we can verify borders of data we want to allow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filtered_midi_df</span> <span class="o">=</span> <span class="n">midi_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">midi_df</span><span class="o">.</span><span class="n">drums</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">midi_df</span><span class="o">.</span><span class="n">midi_error</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">midi_df</span><span class="o">.</span><span class="n">end_time</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">800</span><span class="p">))</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">midi_df</span><span class="o">.</span><span class="n">num_time_signature_changes</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">midi_df</span><span class="o">.</span><span class="n">beat_start</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">midi_df</span><span class="o">.</span><span class="n">tempo</span> <span class="o">&lt;=</span> <span class="mi">500</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">filtered_midi_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>beat_start</th>
      <th>drums</th>
      <th>end_time</th>
      <th>file_path</th>
      <th>instrument_names</th>
      <th>midi_error</th>
      <th>num_time_signature_changes</th>
      <th>resolution</th>
      <th>tempo</th>
      <th>original_names</th>
      <th>num_names</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5</th>
      <td>3.652173</td>
      <td>True</td>
      <td>296.347752</td>
      <td>../datasets/lmd/lmd_full/9/9d30679480d0e55a07b...</td>
      <td>[Piano, Organ, Big Brass, Horns, Horns2, Horns...</td>
      <td>False</td>
      <td>1.0</td>
      <td>120.0</td>
      <td>224.502048</td>
      <td>[S/Smooth .mid]</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>4.547617</td>
      <td>True</td>
      <td>225.896259</td>
      <td>../datasets/lmd/lmd_full/9/974f5b2466a5d5670df...</td>
      <td>[, , , , , , , , , ]</td>
      <td>False</td>
      <td>1.0</td>
      <td>120.0</td>
      <td>184.213982</td>
      <td>[Sure.Polyphone.Midi/A Winter's Tale.mid, w/wi...</td>
      <td>10</td>
    </tr>
    <tr>
      <th>10</th>
      <td>5.419184</td>
      <td>True</td>
      <td>216.460946</td>
      <td>../datasets/lmd/lmd_full/9/952df587b9fff5adbeb...</td>
      <td>[Track 2, Track 3, Track 4, Track 5, Track 6, ...</td>
      <td>False</td>
      <td>1.0</td>
      <td>480.0</td>
      <td>265.636110</td>
      <td>[E/Enola Gay 63.mid, divers midi 3/OMD_-_Enola...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>11</th>
      <td>4.363632</td>
      <td>True</td>
      <td>310.029993</td>
      <td>../datasets/lmd/lmd_full/9/93e2cb3a0c36af361bb...</td>
      <td>[Chorus Guitar, Overdrive Guita, Overdrive Gui...</td>
      <td>False</td>
      <td>1.0</td>
      <td>480.0</td>
      <td>165.000165</td>
      <td>[z/zombie05.mid, Z/zombie05.mid]</td>
      <td>2</td>
    </tr>
    <tr>
      <th>12</th>
      <td>3.545451</td>
      <td>True</td>
      <td>222.766823</td>
      <td>../datasets/lmd/lmd_full/9/97c1f795ffb676dfaa5...</td>
      <td>[BASS, E.PIANO, GUITAR, STRINGS, PIANO, New Tr...</td>
      <td>False</td>
      <td>1.0</td>
      <td>192.0</td>
      <td>212.877687</td>
      <td>[J/J. Rivers Poor Side of Town.mid, divers mid...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>178555</th>
      <td>5.999994</td>
      <td>True</td>
      <td>250.221166</td>
      <td>../datasets/lmd/lmd_full/5/5bd52f314b616bf50c4...</td>
      <td>[Track 1, Track 2, Track 3, Track 4, Track 6, ...</td>
      <td>False</td>
      <td>1.0</td>
      <td>480.0</td>
      <td>141.332152</td>
      <td>[T/taylor_swift-tim_mcgraw.mid]</td>
      <td>1</td>
    </tr>
    <tr>
      <th>178556</th>
      <td>0.000000</td>
      <td>True</td>
      <td>299.296908</td>
      <td>../datasets/lmd/lmd_full/5/5eea68ee369af3ee5cc...</td>
      <td>[You've Made Me So Very Happy, You've Made Me ...</td>
      <td>False</td>
      <td>1.0</td>
      <td>240.0</td>
      <td>184.252715</td>
      <td>[Y/Youvemad L.mid, Y/YOUVEMAD L.mid, Y/YOUVEMA...</td>
      <td>4</td>
    </tr>
    <tr>
      <th>178557</th>
      <td>2.962596</td>
      <td>True</td>
      <td>139.390142</td>
      <td>../datasets/lmd/lmd_full/5/5309fb3f62bf73780e6...</td>
      <td>[, , , , , , , , , ]</td>
      <td>False</td>
      <td>1.0</td>
      <td>120.0</td>
      <td>183.172080</td>
      <td>[R/Roberto Carlos - Propuesta L.mid, Midis Jov...</td>
      <td>3</td>
    </tr>
    <tr>
      <th>178559</th>
      <td>3.802815</td>
      <td>True</td>
      <td>172.389879</td>
      <td>../datasets/lmd/lmd_full/5/5538b0174111bcef760...</td>
      <td>[Std Drums, Jazz Gtr, Muted Gtr (Lead Dbl), Mu...</td>
      <td>False</td>
      <td>1.0</td>
      <td>96.0</td>
      <td>274.353398</td>
      <td>[B/Boys 2.mid, b/boys_2.mid, Beatles +GeorgeJo...</td>
      <td>16</td>
    </tr>
    <tr>
      <th>178560</th>
      <td>0.923077</td>
      <td>True</td>
      <td>293.317332</td>
      <td>../datasets/lmd/lmd_full/5/51e756897765aed30af...</td>
      <td>[, , , , , ]</td>
      <td>False</td>
      <td>1.0</td>
      <td>96.0</td>
      <td>229.821409</td>
      <td>[G/Gerry Boulet Deadline.mid]</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>97615 rows × 11 columns</p>
</div></div></div>
</div>
<p>We now filtered half of our available examples by just looking at the metadata of the MIDI files.
The next step is to extract the drum track of each MIDI filtered MIDI file and save the extracted MIDI file so we can analyse the patterns in of those drum patterns in the next step.</p>
<p>As this part is also computational quite heavy we will again use caching here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">extract_drums</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">extract_path</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;../datasets/lmd/lmd_drums/&#39;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">extract_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;file_path&#39;</span><span class="p">]</span>
    
    <span class="n">extracted_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">extract_path</span><span class="p">,</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">.mid&#39;</span>
    <span class="p">)</span>
    
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">extract_path</span><span class="p">):</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;extracted_file_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">extracted_path</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sound</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">PrettyMIDI</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="n">sound</span><span class="o">.</span><span class="n">instruments</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sound</span><span class="o">.</span><span class="n">instruments</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">is_drum</span><span class="p">]</span>
            <span class="n">sound</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">extracted_path</span><span class="p">)</span>
            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;extracted_file_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">extracted_path</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Failed to extract </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;fail_extract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">row</span>

<span class="k">def</span> <span class="nf">load_extracted_drums_df</span><span class="p">(</span>
    <span class="n">filtered_midi_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">save_path</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span><span class="s1">&#39;extracted_drums_df.parquet&#39;</span><span class="p">,</span>
    <span class="n">force_reload</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_reload</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Load dataframe from </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_midi_df</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Loaded dataframe does not match filtered - consider rebuild of cache&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">filtered_midi_df</span><span class="o">.</span><span class="n">swifter</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">extract_drums</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Saved dataframe in </span><span class="si">{</span><span class="n">save_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">extract_drums_df</span> <span class="o">=</span> <span class="n">load_extracted_drums_df</span><span class="p">(</span><span class="n">filtered_midi_df</span><span class="p">)</span>
<span class="n">extract_drums_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Load dataframe from extracted_drums_df.parquet
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>beat_start</th>
      <th>drums</th>
      <th>end_time</th>
      <th>file_path</th>
      <th>instrument_names</th>
      <th>midi_error</th>
      <th>num_time_signature_changes</th>
      <th>resolution</th>
      <th>tempo</th>
      <th>extracted_file_path</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5</th>
      <td>3.652173</td>
      <td>True</td>
      <td>296.347752</td>
      <td>../datasets/lmd/lmd_full/9/9d30679480d0e55a07b...</td>
      <td>[Piano, Organ, Big Brass, Horns, Horns2, Horns...</td>
      <td>False</td>
      <td>1.0</td>
      <td>120.0</td>
      <td>224.502048</td>
      <td>../datasets/lmd/lmd_drums/9d30679480d0e55a07be...</td>
    </tr>
    <tr>
      <th>9</th>
      <td>4.547617</td>
      <td>True</td>
      <td>225.896259</td>
      <td>../datasets/lmd/lmd_full/9/974f5b2466a5d5670df...</td>
      <td>[, , , , , , , , , ]</td>
      <td>False</td>
      <td>1.0</td>
      <td>120.0</td>
      <td>184.213982</td>
      <td>../datasets/lmd/lmd_drums/974f5b2466a5d5670dfd...</td>
    </tr>
    <tr>
      <th>10</th>
      <td>5.419184</td>
      <td>True</td>
      <td>216.460946</td>
      <td>../datasets/lmd/lmd_full/9/952df587b9fff5adbeb...</td>
      <td>[Track 2, Track 3, Track 4, Track 5, Track 6, ...</td>
      <td>False</td>
      <td>1.0</td>
      <td>480.0</td>
      <td>265.636110</td>
      <td>../datasets/lmd/lmd_drums/952df587b9fff5adbeb5...</td>
    </tr>
    <tr>
      <th>11</th>
      <td>4.363632</td>
      <td>True</td>
      <td>310.029993</td>
      <td>../datasets/lmd/lmd_full/9/93e2cb3a0c36af361bb...</td>
      <td>[Chorus Guitar, Overdrive Guita, Overdrive Gui...</td>
      <td>False</td>
      <td>1.0</td>
      <td>480.0</td>
      <td>165.000165</td>
      <td>../datasets/lmd/lmd_drums/93e2cb3a0c36af361bb4...</td>
    </tr>
    <tr>
      <th>12</th>
      <td>3.545451</td>
      <td>True</td>
      <td>222.766823</td>
      <td>../datasets/lmd/lmd_full/9/97c1f795ffb676dfaa5...</td>
      <td>[BASS, E.PIANO, GUITAR, STRINGS, PIANO, New Tr...</td>
      <td>False</td>
      <td>1.0</td>
      <td>192.0</td>
      <td>212.877687</td>
      <td>../datasets/lmd/lmd_drums/97c1f795ffb676dfaa5a...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>178555</th>
      <td>5.999994</td>
      <td>True</td>
      <td>250.221166</td>
      <td>../datasets/lmd/lmd_full/5/5bd52f314b616bf50c4...</td>
      <td>[Track 1, Track 2, Track 3, Track 4, Track 6, ...</td>
      <td>False</td>
      <td>1.0</td>
      <td>480.0</td>
      <td>141.332152</td>
      <td>../datasets/lmd/lmd_drums/5bd52f314b616bf50c40...</td>
    </tr>
    <tr>
      <th>178556</th>
      <td>0.000000</td>
      <td>True</td>
      <td>299.296908</td>
      <td>../datasets/lmd/lmd_full/5/5eea68ee369af3ee5cc...</td>
      <td>[You've Made Me So Very Happy, You've Made Me ...</td>
      <td>False</td>
      <td>1.0</td>
      <td>240.0</td>
      <td>184.252715</td>
      <td>../datasets/lmd/lmd_drums/5eea68ee369af3ee5cc5...</td>
    </tr>
    <tr>
      <th>178557</th>
      <td>2.962596</td>
      <td>True</td>
      <td>139.390142</td>
      <td>../datasets/lmd/lmd_full/5/5309fb3f62bf73780e6...</td>
      <td>[, , , , , , , , , ]</td>
      <td>False</td>
      <td>1.0</td>
      <td>120.0</td>
      <td>183.172080</td>
      <td>../datasets/lmd/lmd_drums/5309fb3f62bf73780e61...</td>
    </tr>
    <tr>
      <th>178559</th>
      <td>3.802815</td>
      <td>True</td>
      <td>172.389879</td>
      <td>../datasets/lmd/lmd_full/5/5538b0174111bcef760...</td>
      <td>[Std Drums, Jazz Gtr, Muted Gtr (Lead Dbl), Mu...</td>
      <td>False</td>
      <td>1.0</td>
      <td>96.0</td>
      <td>274.353398</td>
      <td>../datasets/lmd/lmd_drums/5538b0174111bcef760a...</td>
    </tr>
    <tr>
      <th>178560</th>
      <td>0.923077</td>
      <td>True</td>
      <td>293.317332</td>
      <td>../datasets/lmd/lmd_full/5/51e756897765aed30af...</td>
      <td>[, , , , , ]</td>
      <td>False</td>
      <td>1.0</td>
      <td>96.0</td>
      <td>229.821409</td>
      <td>../datasets/lmd/lmd_drums/51e756897765aed30af2...</td>
    </tr>
  </tbody>
</table>
<p>97615 rows × 10 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>We now filtered out all unwanted parts of our dataset and isolated the drum track to a new MIDI file.</p>
<p>In the next step we will start to analyse the drum patterns that we extracted.</p>
</div>
</div>


              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="../docs/basics/python.html" title="previous page">Python basics</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Dennis Scheiba<br/>
        
            &copy; Copyright 2021, Dennis Scheiba.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>