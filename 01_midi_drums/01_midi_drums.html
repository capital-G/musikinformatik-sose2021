
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Extracting information from MIDI files &#8212; Musikinformatik SoSe2021</title>
    
  <link rel="stylesheet" href="../_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Python basics" href="../docs/basics/python.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  
  <h1 class="site-logo" id="site-title">Musikinformatik SoSe2021</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <p class="caption collapsible-parent">
 <span class="caption-text">
  Course information
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/course-info/setup.html">
   Environment setup
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/bib.html">
   Bibliography
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Basics
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/basics/math.html">
   Math basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../docs/basics/python.html">
   Python basics
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Lesson 1
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Extracting information from MIDI files
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/01_midi_drums/01_midi_drums.ipynb.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/capital-G/musikinformatik-sose2021"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/capital-G/musikinformatik-sose2021/issues/new?title=Issue%20on%20page%20%2F01_midi_drums/01_midi_drums.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/capital-G/musikinformatik-sose2021/edit/main/01_midi_drums/01_midi_drums.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/capital-G/musikinformatik-sose2021/main?urlpath=tree/01_midi_drums/01_midi_drums.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-the-dataset">
   Getting the dataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#parsing-the-dataset">
   Parsing the dataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-midi-files-in-python">
   Loading MIDI files in Python
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#performance">
     Performance
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#processing-all-files">
   Processing all files
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis-of-metadata">
   Analysis of metadata
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#filter-and-extract-the-data">
   Filter and extract the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="extracting-information-from-midi-files">
<h1>Extracting information from MIDI files<a class="headerlink" href="#extracting-information-from-midi-files" title="Permalink to this headline">¶</a></h1>
<p>In our first lesson we want to get to know how to work with datasets so we can</p>
<ul class="simple">
<li><p>parse a dataset</p></li>
<li><p>analyse the dataset so it matches our expectations</p></li>
<li><p>check if errors occured during parsing</p></li>
</ul>
<p>After this is done we want to take a look at how we can generate new drum patterns from the existing one.
But in order to do this we want to take a look at the quantisation (?) of our patterns.</p>
<p>The cleaning of the dataset and setting the data up properly takes the most time in such experiments but if one makes errors here those errors will propagate through our system - so its good to spend some time at this task.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>  <span class="c1"># makes the randomness deterministic</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1"># todo: try %matplotlib widget</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.grid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="getting-the-dataset">
<h2>Getting the dataset<a class="headerlink" href="#getting-the-dataset" title="Permalink to this headline">¶</a></h2>
<p>As our methods rely on data we need a way to obtain such data and this will be on of our first endeavours in this machine learning based workshop.
Thankfully there are search engines which help us to find data in the internet easily.
One search results when one searches for <em>midi dataset</em> is <a class="reference external" href="https://colinraffel.com/projects/lmd/">https://colinraffel.com/projects/lmd/</a>.</p>
<blockquote>
<div><p>The Lakh MIDI dataset is a collection of 176,581 unique MIDI files, 45,129 of which have been matched and aligned to entries in the Million Song Dataset. […]</p>
</div></blockquote>
<p>Of course the cultural skewness of such a dataset is a thing we need to be aware of.
What kind of music is transcribable into the MIDI format and what kind of music is transcribed as MIDI at all.
Maybe we can shed some light into the last question by inspecting the dataset.
But before we can do this we need to download and understand the dataset.</p>
<p>We use a function which will check if the files are already downloaded and if not will download and extract the directory.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="k">def</span> <span class="nf">download_dataset</span><span class="p">(</span><span class="n">download_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;../datasets/lmd&quot;</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_path</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">archive_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_path</span><span class="p">,</span> <span class="s2">&quot;lmd_full&quot;</span><span class="p">)</span>
    
    <span class="n">dl_files</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;midi&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_path</span><span class="p">,</span> <span class="s2">&quot;lmd_full.tap.gz&quot;</span><span class="p">),</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://hog.ee.columbia.edu/craffel/lmd/lmd_full.tar.gz&quot;</span>
        <span class="p">},</span>
        <span class="s2">&quot;json&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_path</span><span class="p">,</span> <span class="s2">&quot;md5_to_path.json&quot;</span><span class="p">),</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://hog.ee.columbia.edu/craffel/lmd/md5_to_paths.json&quot;</span>
        <span class="p">},</span>
    <span class="p">}</span>
    
    <span class="k">for</span> <span class="n">dl_name</span><span class="p">,</span> <span class="n">dl</span> <span class="ow">in</span> <span class="n">dl_files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dl</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">dl_name</span> <span class="o">==</span> <span class="s2">&quot;midi&quot;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">archive_dir</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dl_name</span><span class="si">}</span><span class="s2"> already downloaded to </span><span class="si">{</span><span class="n">dl</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start downloading </span><span class="si">{</span><span class="n">dl_name</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">dl</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> - this can take multiple minutes!&quot;</span><span class="p">)</span>
        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">dl</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">],</span> <span class="n">dl</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Finished downloading&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">archive_dir</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start extracting the files of archive - this will take some minutes&quot;</span><span class="p">)</span>
        <span class="c1"># todo: windows has no tar</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span>
            <span class="s1">&#39;tar&#39;</span><span class="p">,</span> <span class="s1">&#39;-xzf&#39;</span><span class="p">,</span> <span class="n">dl_files</span><span class="p">[</span><span class="s2">&quot;midi&quot;</span><span class="p">][</span><span class="s2">&quot;path&quot;</span><span class="p">],</span>
            <span class="s1">&#39;-C&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_path</span><span class="p">)</span>
        <span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished extracting&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dl_files</span><span class="p">[</span><span class="s2">&quot;midi&quot;</span><span class="p">][</span><span class="s2">&quot;path&quot;</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Remove archive&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dl_files</span><span class="p">[</span><span class="s2">&quot;midi&quot;</span><span class="p">][</span><span class="s2">&quot;path&quot;</span><span class="p">])</span>

<span class="n">download_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>midi already downloaded to ../datasets/lmd/lmd_full.tap.gz
json already downloaded to ../datasets/lmd/md5_to_path.json
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="parsing-the-dataset">
<h2>Parsing the dataset<a class="headerlink" href="#parsing-the-dataset" title="Permalink to this headline">¶</a></h2>
<p>When working with large sets of files the unix utility <a class="reference external" href="https://en.wikipedia.org/wiki/Glob_(programming)">glob</a> comes in handy as we can describe the pattern of the file paths we want to match instead of listing all files.</p>
<p>When we take a quick look at the pattern it seems they all follow a structure like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">../</span><span class="n">datasets</span><span class="o">/</span><span class="n">lmd</span><span class="o">/</span><span class="n">lmd_full</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="n">a0cbb3f083d14d57858c87b26f85873</span><span class="o">.</span><span class="n">mid</span>
</pre></div>
</div>
<p>Soon we will understand why the filename has this cryptic format, but for now we simply want to parse all available files into an array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;../datasets/lmd/lmd_full/*/*.mid&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">midi_files</span><span class="p">)</span><span class="si">}</span><span class="s1"> midi files in dataset&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found 178561 midi files in dataset
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># select 5 random files</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">midi_files</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;../datasets/lmd/lmd_full/4/4a69b1a10e4dbe409ac922de4f6256d8.mid&#39;,
       &#39;../datasets/lmd/lmd_full/b/b102261b4c27ea58bad4777b5df5be5e.mid&#39;,
       &#39;../datasets/lmd/lmd_full/3/3a8ccaab480919c35f37fdf08c238e29.mid&#39;,
       &#39;../datasets/lmd/lmd_full/d/dc6416232e05b3d44fb62007ca84b474.mid&#39;,
       &#39;../datasets/lmd/lmd_full/4/4fb744a04c1afbb0309b581410b33363.mid&#39;],
      dtype=&#39;&lt;U63&#39;)
</pre></div>
</div>
</div>
</div>
<p>But how are sure that we matched every midi file in our folder?
We can simply match every file in our dataset directory and show us the differences by using <a class="reference external" href="https://realpython.com/python-sets/">sets</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">missed_files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;../datasets/lmd/lmd_full/**/*.*&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">midi_files</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Did not match </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">missed_files</span><span class="p">)</span><span class="si">}</span><span class="s1"> files&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Did not match 0 files
</pre></div>
</div>
</div>
</div>
<p>Thankfully we have a rather clean dataset here which does not force us to do file acrobatics.</p>
<p>But we did not just download MIDI files, we also downloaded a JSON file which we will now take a look into.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;../datasets/lmd/md5_to_path.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">md5_filenames</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

<span class="n">example_midi_file</span> <span class="o">=</span> <span class="s1">&#39;../datasets/lmd/lmd_full/e/ed05335f8f6c273f506a997137b2805b.mid&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Choosed </span><span class="si">{</span><span class="n">example_midi_file</span><span class="si">}</span><span class="s2"> as example MIDI file&quot;</span><span class="p">)</span>
<span class="c1"># with split we remove the folder name and the file extension</span>
<span class="n">md5_filenames</span><span class="p">[</span><span class="n">example_midi_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Choosed ../datasets/lmd/lmd_full/e/ed05335f8f6c273f506a997137b2805b.mid as example MIDI file
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;QUALITY MIDI/EClapton-Promises.mid&#39;]
</pre></div>
</div>
</div>
</div>
<p>So - why do we have an additional file which tells us the original filename?
This is actually a good trick in order to avoid duplicates in the dataset - we use a so called hash function which will return a cryptic string depending on the data that we <em>hash</em>.
Two files will produce the same hash output - so if we simple rename each file to the hash it produces we will automatically delete and detect all duplicates in our dataset.
This is a common practice if the data was obtained by scraping multiple sources for data.</p>
<p>Lets just take a look if we can verify this claim.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hashlib</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">example_midi_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">file_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
    <span class="k">while</span> <span class="n">chunk</span> <span class="o">:=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8192</span><span class="p">):</span>
        <span class="n">file_hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hash for </span><span class="si">{</span><span class="n">example_midi_file</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">file_hash</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Hash for ../datasets/lmd/lmd_full/e/ed05335f8f6c273f506a997137b2805b.mid is ed05335f8f6c273f506a997137b2805b
</pre></div>
</div>
</div>
</div>
<p>This also gives us a nice additional information - a common MIDI file will probably have lots of different names as it was scraped from multiple files which probably changed the filenames a bit.</p>
</div>
<div class="section" id="loading-midi-files-in-python">
<h2>Loading MIDI files in Python<a class="headerlink" href="#loading-midi-files-in-python" title="Permalink to this headline">¶</a></h2>
<p>Now as we have all file paths available it is a good practice to take a first look at the data.
We need to understand how the information we are interested in is accessible and also that it is probably not in a clean and standardized manner.</p>
<p>As there is no build in functionality in <em>Python</em> to work with MIDI data we will need to rely in a library.
<a class="reference external" href="https://pypi.org/search/?q=midi">There are a numerous libraries</a> for working with MIDI data in Python but we will rely on <a class="reference external" href="https://github.com/craffel/pretty-midi">pretty_midi</a> to inspect the MIDI files.</p>
<p>As we have quite some data to process it is worth making some research on how we can reduce the amount of data we need to process before we process the whole dataset and bring it into a good format we can work with.
From the <a class="reference external" href="https://en.wikipedia.org/wiki/General_MIDI#Percussive">wikipedia article on General MIDI (GM)</a> we can see that percussive tracks should be on channel 10 - so for now we can simply ignore the other tracks.</p>
<p>In a former version of this document we used the library <a class="reference external" href="http://web.mit.edu/music21/">music21</a> for parsing and loading of our MIDI files but it turns out that <a class="reference external" href="https://github.com/capital-G/musikinformatik-sose2021/issues/24#issuecomment-823625482">music21 is too slow for our big dataset</a>.</p>
<p>We also start annotating our dataset using <a class="reference external" href="https://pandas.pydata.org/">pandas</a> which is a library for data analysis and manipulation to keep track of any metadata the files have and will also help us on the analysis of the metadafiles.</p>
<p>Additionally we will use <a class="reference external" href="https://en.wikipedia.org/wiki/Cache_(computing)">caching</a> because the meta-analyis of our MIDI files takes about 2 hours on a recent MacBook.
Caching means that we will store the results on the hard drive so once we calculated them we do not need to re-calculate them because we will just load the files from the hard drive.
It is a common practice in data science to write a function which either loads the data from a file or generates the file we are using as generating or calculating the data is a step which takes often a long time.</p>
<p>We will start by inspecting how we can access MIDI information from within <em>pretty_midi</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pretty_midi</span> <span class="k">as</span> <span class="nn">pm</span>

<span class="n">midi_stream</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">PrettyMIDI</span><span class="p">(</span><span class="n">example_midi_file</span><span class="p">)</span>
<span class="n">midi_stream</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;pretty_midi.pretty_midi.PrettyMIDI at 0x103c295b0&gt;
</pre></div>
</div>
</div>
</div>
<p>After we have now loaded a MIDI file with <em>pretty_midi</em> we now take a look at how we can access the data.
Therefore the <a class="reference external" href="https://craffel.github.io/pretty-midi/">documentation of pretty_midi</a> will help us to know how to access the MIDI information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_stream</span><span class="o">.</span><span class="n">get_end_time</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>189.431068
</pre></div>
</div>
</div>
</div>
<p>will give us the time in seconds of the MIDI file</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_stream</span><span class="o">.</span><span class="n">get_beats</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">]</span>  <span class="c1"># limit to 50 entries for printing</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.0000000e+00, 1.2500000e-02, 4.4107100e-01, 8.6964200e-01,
       1.2982130e+00, 1.7267840e+00, 2.1553550e+00, 2.5839260e+00,
       3.0124970e+00, 3.4410680e+00, 3.8410680e+00, 4.2410680e+00,
       4.6410680e+00, 5.0410680e+00, 5.4410680e+00, 5.8410680e+00,
       6.2410680e+00, 6.6410680e+00, 7.0410680e+00, 7.4410680e+00,
       7.8410680e+00, 8.2410680e+00, 8.6410680e+00, 9.0410680e+00,
       9.4410680e+00, 9.8410680e+00, 1.0241068e+01, 1.0641068e+01,
       1.1041068e+01, 1.1441068e+01, 1.1841068e+01, 1.2241068e+01,
       1.2641068e+01, 1.3041068e+01, 1.3441068e+01, 1.3841068e+01,
       1.4241068e+01, 1.4641068e+01, 1.5041068e+01, 1.5441068e+01,
       1.5841068e+01, 1.6241068e+01, 1.6641068e+01, 1.7041068e+01,
       1.7441068e+01, 1.7841068e+01, 1.8241068e+01, 1.8641068e+01,
       1.9041068e+01, 1.9441068e+01])
</pre></div>
</div>
</div>
</div>
<p>will give us the position in secounds of all beats (so any action) in a MIDI file</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_stream</span><span class="o">.</span><span class="n">get_tempo_changes</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([0.      , 0.0125  , 3.441068]),
 array([120.     , 140.00014, 150.     ]))
</pre></div>
</div>
</div>
</div>
<p>will tell us any changes in the tempo in bpm.
Keep in mind that we do not have two tempo changes here but that the function returns two arrays - the first one with the mark in seconds where the tempo gets changed and another one to what bpm it changes - for now we are only interested in the second array.</p>
<p>We should also prepare for the case that the MIDI file does not provide any tempo information.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_stream</span><span class="o">.</span><span class="n">time_signature_changes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[TimeSignature(numerator=4, denominator=4, time=0.0125),
 TimeSignature(numerator=2, denominator=4, time=21.041068000000003),
 TimeSignature(numerator=4, denominator=4, time=21.841068000000003),
 TimeSignature(numerator=2, denominator=4, time=36.241068000000006),
 TimeSignature(numerator=4, denominator=4, time=37.041068),
 TimeSignature(numerator=2, denominator=4, time=51.441068),
 TimeSignature(numerator=4, denominator=4, time=52.241068000000006),
 TimeSignature(numerator=2, denominator=4, time=66.641068),
 TimeSignature(numerator=4, denominator=4, time=67.441068),
 TimeSignature(numerator=2, denominator=4, time=107.441068),
 TimeSignature(numerator=4, denominator=4, time=108.24106800000001),
 TimeSignature(numerator=2, denominator=4, time=122.641068),
 TimeSignature(numerator=4, denominator=4, time=123.44106800000002)]
</pre></div>
</div>
</div>
</div>
<p>tells us the time signatures of the MIDI file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_signature</span> <span class="o">=</span> <span class="n">midi_stream</span><span class="o">.</span><span class="n">time_signature_changes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">time_signature</span><span class="o">.</span><span class="n">numerator</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">time_signature</span><span class="o">.</span><span class="n">denominator</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4/4
</pre></div>
</div>
</div>
</div>
<p>As with the tempo we should also prepare for the case that no time signature information is given on the MIDI file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_stream</span><span class="o">.</span><span class="n">instruments</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Instrument(program=62, is_drum=False, name=&quot;&quot;),
 Instrument(program=34, is_drum=False, name=&quot;&quot;),
 Instrument(program=25, is_drum=False, name=&quot;&quot;),
 Instrument(program=28, is_drum=False, name=&quot;&quot;),
 Instrument(program=25, is_drum=False, name=&quot;&quot;),
 Instrument(program=30, is_drum=False, name=&quot;&quot;),
 Instrument(program=26, is_drum=False, name=&quot;&quot;),
 Instrument(program=18, is_drum=False, name=&quot;&quot;),
 Instrument(program=0, is_drum=True, name=&quot;&quot;),
 Instrument(program=0, is_drum=True, name=&quot;&quot;),
 Instrument(program=0, is_drum=True, name=&quot;&quot;),
 Instrument(program=0, is_drum=True, name=&quot;&quot;),
 Instrument(program=0, is_drum=True, name=&quot;&quot;)]
</pre></div>
</div>
</div>
</div>
<p>gives us access to all instruments with its names and if this is a drum track or not.</p>
<p>We can also take a look at the notes of each instrument</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_stream</span><span class="o">.</span><span class="n">instruments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">notes</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Note(start=9.834401, end=9.937735, pitch=62, velocity=109),
 Note(start=10.037735, end=10.311068, pitch=62, velocity=107),
 Note(start=10.437735, end=10.847735, pitch=62, velocity=113),
 Note(start=10.834401, end=11.057735, pitch=60, velocity=109),
 Note(start=11.034401, end=11.237735, pitch=59, velocity=106),
 Note(start=11.237735, end=11.594401, pitch=62, velocity=108),
 Note(start=11.627735, end=11.834401, pitch=60, velocity=101),
 Note(start=11.827735, end=12.247735, pitch=59, velocity=108),
 Note(start=12.224401, end=12.544401, pitch=62, velocity=106),
 Note(start=13.024401, end=13.131068, pitch=64, velocity=102)]
</pre></div>
</div>
</div>
</div>
<div class="section" id="performance">
<h3>Performance<a class="headerlink" href="#performance" title="Permalink to this headline">¶</a></h3>
<p>Now we know how we can use <em>pretty_midi</em> to load a MIDI file and access the information of a single MIDI file.
But the problem is that a loading of a MIDI file is pretty slow in Python - we will do some measurements now to have a quick way to access the information we are interested in.</p>
<p>We can use a built in tool of <em>Jupyter</em> which is <code class="docutils literal notranslate"><span class="pre">%%timeit</span></code> which will do multiple runs of a cell and measure the time it takes for each run.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it

<span class="n">pm</span><span class="o">.</span><span class="n">PrettyMIDI</span><span class="p">(</span><span class="n">example_midi_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>144 ms ± 1.1 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div>
</div>
</div>
</div>
<p>Of course this time to parse the MIDI file depends on the complexity of our MIDI file but now its time to do some maths.
For the sake of simplicity we will assume that it takes around 100ms to load a MIDI file.</p>
<div class="math notranslate nohighlight">
\[ 0.1 \frac{\text{sec}}{\text{file}} * 178000 \text{ files} = 17800 \text{ sec} \approx 296 \text{ minutes} \approx 4 \text{ hours}\]</div>
<p>Note that this assumes we do not process multiple files in paralell which is possible but also tricky.
Also this is only for the loading of the data, we not have acessed yet any data.</p>
<p>Maybe there is a file format to which we can store the MIDI files and load them quicker whenever we need them.
<a class="reference external" href="https://github.com/magenta/note-seq"><em>note_seq</em></a> from the <a class="reference external" href="https://magenta.tensorflow.org/">magenata project</a> provide such a format called <em>note sequence</em> which nicely interacts with <em>pretty_midi</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">note_seq</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it

<span class="n">notes</span> <span class="o">=</span> <span class="n">note_seq</span><span class="o">.</span><span class="n">midi_to_note_sequence</span><span class="p">(</span><span class="n">midi_stream</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>13 ms ± 159 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre></div>
</div>
</div>
</div>
<p>So the conversion of this file works fast compared to the parsing of our MIDI file.
The problem is that we still need the MIDI file parsed and we have not yet took a look at the saving and loading of a note sequence.</p>
<p><em>note_seq</em> is using a special kind of format for this which is called <a class="reference external" href="https://developers.google.com/protocol-buffers/docs/pythontutorial">protobuf</a> - a binary file format to store and exchange files developed by Google.
The advantage is that this is really fast and efficient as its binary and we can exchange the files to other programming languages - think of it like a binary version of JSON but with type safety included.</p>
<p>We start by saving the note sequence into a protobuf and try loading it again from our harddrive.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">notes</span> <span class="o">=</span> <span class="n">note_seq</span><span class="o">.</span><span class="n">midi_to_note_sequence</span><span class="p">(</span><span class="n">midi_stream</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;note_seq_test.protobuf&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">notes</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;note_seq_test.protobuf&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">notes_loaded</span> <span class="o">=</span> <span class="n">note_seq</span><span class="o">.</span><span class="n">NoteSequence</span><span class="o">.</span><span class="n">FromString</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.59 ms ± 110 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
</pre></div>
</div>
</div>
</div>
<p>Lets say it takes about 4 ms to load a protobuf file - now we will do the calculation from before again.</p>
<div class="math notranslate nohighlight">
\[ 0.004 \frac{\text{sec}}{\text{file}} * 178000 \text{ files} = 712 \text{ sec} \approx 11 \text{ minutes}\]</div>
<p>which is much more acceptable.
And we have not yet considered any parallelisation of the code.</p>
<p>But before we convert everything to a note sequence as a protobuf we should compare the file size of the two file formats.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="n">example_midi_file</span><span class="p">,</span> <span class="s1">&#39;note_seq_test.protobuf&#39;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File size of </span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">/</span><span class="mi">1024</span><span class="si">}</span><span class="s1"> kbytes&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>File size of ../datasets/lmd/lmd_full/e/ed05335f8f6c273f506a997137b2805b.mid: 46.6513671875 kbytes
File size of note_seq_test.protobuf: 195.958984375 kbytes
</pre></div>
</div>
</div>
</div>
<p>It turns out that we are trading storage in favour of computation power.</p>
<p>Before we can decide if we want to trade we may need to take a look at the file size of our MIDI dataset.
For this we can use a functionality of Jupyter to execute commands in a shell from within Jupyter by appending a <code class="docutils literal notranslate"><span class="pre">!</span></code> in front of the command.
In order to get the size of a dictionary we will use the unix tool <a class="reference external" href="https://linux.die.net/man/1/du">du</a> with the arguments <code class="docutils literal notranslate"><span class="pre">s</span></code> (sum everything within the path) and <code class="docutils literal notranslate"><span class="pre">h</span></code> (convert number of bytes to a human readable format).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>du -sh ../datasets/lmd/lmd_full
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.9G	../datasets/lmd/lmd_full
</pre></div>
</div>
</div>
</div>
<p>We have around 6 gigabytes of files here - when we are converting them to protobuf we will blow them up with a factor of <span class="math notranslate nohighlight">\(\approx 4\)</span> so we will have about 24 GB of protobuf files which is somehow still acceptable.</p>
</div>
</div>
<div class="section" id="processing-all-files">
<h2>Processing all files<a class="headerlink" href="#processing-all-files" title="Permalink to this headline">¶</a></h2>
<p>So after we now know how to load, access and convert the files to a nicer format we still need to take a look at how we can do this on our 180k files and maybe save some time here by using some programming.</p>
<p>First we will start by programming a function in which we combine everything we did before and return us all necessary information as a dictionary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PROTO_SAVE_PATH</span> <span class="o">=</span> <span class="s1">&#39;../datasets/lmd/proto/&#39;</span>

<span class="c1"># make sure that the folder we want to save to actually exists</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">PROTO_SAVE_PATH</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>

<span class="kn">from</span> <span class="nn">mido</span> <span class="kn">import</span> <span class="n">KeySignatureError</span>

<span class="k">def</span> <span class="nf">parse_midi_file</span><span class="p">(</span><span class="n">midi_file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">proto_save_path</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="n">PROTO_SAVE_PATH</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;midi_path&#39;</span><span class="p">:</span> <span class="n">midi_file_path</span><span class="p">,</span>
        <span class="s1">&#39;midi_error&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">midi_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">midi_file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">proto_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PROTO_SAVE_PATH</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">midi_name</span><span class="si">}</span><span class="s1">.protobuf&#39;</span><span class="p">)</span>
    
    <span class="n">r</span><span class="p">[</span><span class="s1">&#39;original_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">md5_filenames</span><span class="p">[</span><span class="n">midi_name</span><span class="p">]</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">PrettyMIDI</span><span class="p">(</span><span class="n">midi_file_path</span><span class="p">)</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;midi_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">,</span> <span class="n">KeySignatureError</span><span class="p">,</span> <span class="ne">EOFError</span><span class="p">,</span> <span class="ne">ZeroDivisionError</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">r</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># r[&#39;beat_start&#39;] = stream.estimate_beat_start() # omitted b/c adds 200ms to parsing</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;estimate_tempo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">estimate_tempo</span><span class="p">()</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;tempi_sec&#39;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;tempi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">get_tempo_changes</span><span class="p">()</span> 
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">get_end_time</span><span class="p">()</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;drums&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">any</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">is_drum</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">stream</span><span class="o">.</span><span class="n">instruments</span><span class="p">])</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">resolution</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;instrument_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">stream</span><span class="o">.</span><span class="n">instruments</span><span class="p">]</span>
        <span class="n">r</span><span class="p">[</span><span class="s1">&#39;num_time_signature_changes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">time_signature_changes</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># ValueError: Can&#39;t estimate beat start when there are no notes.</span>
        <span class="c1"># ValueError: Can&#39;t provide a global tempo estimate when there are fewer than two notes.</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not parse MIDI file </span><span class="si">{</span><span class="n">midi_file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">notes</span> <span class="o">=</span> <span class="n">note_seq</span><span class="o">.</span><span class="n">midi_to_note_sequence</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">proto_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">notes</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span>
    <span class="n">r</span><span class="p">[</span><span class="s1">&#39;proto_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proto_path</span>
    
    <span class="k">return</span> <span class="n">r</span>
</pre></div>
</div>
</div>
</div>
<p>Now we want to try out the function on a single MIDI file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parse_midi_file</span><span class="p">(</span><span class="n">example_midi_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;midi_path&#39;: &#39;../datasets/lmd/lmd_full/e/ed05335f8f6c273f506a997137b2805b.mid&#39;,
 &#39;midi_error&#39;: False,
 &#39;original_names&#39;: [&#39;QUALITY MIDI/EClapton-Promises.mid&#39;],
 &#39;estimate_tempo&#39;: 159.6553471870248,
 &#39;tempi_sec&#39;: array([0.      , 0.0125  , 3.441068]),
 &#39;tempi&#39;: array([120.     , 140.00014, 150.     ]),
 &#39;end_time&#39;: 189.431068,
 &#39;drums&#39;: True,
 &#39;resolution&#39;: 120,
 &#39;instrument_names&#39;: [&#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;, &#39;&#39;],
 &#39;num_time_signature_changes&#39;: 13,
 &#39;proto_path&#39;: &#39;../datasets/lmd/proto/ed05335f8f6c273f506a997137b2805b.protobuf&#39;}
</pre></div>
</div>
</div>
</div>
<p>So this works as expected - time to time it as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>it

<span class="n">parse_midi_file</span><span class="p">(</span><span class="n">example_midi_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>178 ms ± 2.15 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
</pre></div>
</div>
</div>
</div>
<p>It seems that accessing the MIDI data via <em>pretty_midi</em> does not come for free.
Repeating the calculation from before:</p>
<div class="math notranslate nohighlight">
\[ 0.2 \frac{\text{sec}}{\text{file}} * 178000 \text{ files} = 35600 \text{ sec} \approx 593 \text{ minutes} \approx 10 \text{ hours}\]</div>
<p>This is not unheard of but we can reduce the time by parallelizing it for which we need to do some tricks into which we will not go detail.
On a recent i9 processor the next step will take around 90 minutes if executed for the first time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">helpers.helpers</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">load_midi_files</span><span class="p">(</span><span class="n">parquet_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;midi_files_</span><span class="si">{}</span><span class="s1">.parquet&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="n">parquet_path</span> <span class="o">=</span> <span class="n">parquet_path</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">limit</span> <span class="k">if</span> <span class="n">limit</span> <span class="k">else</span> <span class="s1">&#39;full&#39;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">parquet_path</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Use cached parquet file </span><span class="si">{</span><span class="n">parquet_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">parquet_path</span><span class="p">)</span>
    
    <span class="n">midi_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;../datasets/lmd/lmd_full/*/*.mid&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">limit</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Limit to </span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s1"> files&#39;</span><span class="p">)</span>
        <span class="n">midi_files</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">midi_files</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Parse </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">midi_files</span><span class="p">)</span><span class="si">}</span><span class="s1"> midi files&#39;</span><span class="p">)</span>
    
    <span class="n">cpu_count</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span><span class="o">*</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">cpu_count</span><span class="p">,</span> <span class="n">maxtasksperchild</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
        <span class="n">midi_meta</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">parse_midi_file_async</span><span class="p">,</span> <span class="n">midi_files</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Finished parsing midi files&#39;</span><span class="p">)</span>
    
    <span class="n">midi_meta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">midi_meta</span><span class="p">)</span>
    <span class="n">midi_meta</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span><span class="n">parquet_path</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">midi_meta</span>

<span class="c1"># if you want to work with a random subset set the limit argument to num of files as a limit</span>
<span class="n">midi_df</span> <span class="o">=</span> <span class="n">load_midi_files</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="n">midi_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Use cached parquet file midi_files_full.parquet
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>midi_path</th>
      <th>midi_error</th>
      <th>estimate_tempo</th>
      <th>tempi_sec</th>
      <th>tempi</th>
      <th>end_time</th>
      <th>drums</th>
      <th>resolution</th>
      <th>instrument_names</th>
      <th>num_time_signature_changes</th>
      <th>proto_path</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>81923</th>
      <td>../datasets/lmd/lmd_full/f/f4b72836981feedb9e1...</td>
      <td>False</td>
      <td>175.232953</td>
      <td>[0.0]</td>
      <td>[82.00003553334874]</td>
      <td>128.780432</td>
      <td>True</td>
      <td>384.0</td>
      <td>[harmnica, accordn2, drum, acoubass, pianogrd,...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/f4b72836981feedb9e1046f1...</td>
    </tr>
    <tr>
      <th>171833</th>
      <td>../datasets/lmd/lmd_full/5/5f3eaf75cbc1b2554df...</td>
      <td>False</td>
      <td>213.043443</td>
      <td>[0.0, 297.04290665, 297.1153704, 297.188899816...</td>
      <td>[69.99998833333528, 69.00001725000433, 67.9999...</td>
      <td>302.411045</td>
      <td>True</td>
      <td>120.0</td>
      <td>[YO TE AMO;CHAYANE, YO TE AMO;CHAYANE, YO TE A...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/5f3eaf75cbc1b2554dfa60bd...</td>
    </tr>
    <tr>
      <th>161501</th>
      <td>../datasets/lmd/lmd_full/2/2f02103cfb1764e661d...</td>
      <td>False</td>
      <td>170.691458</td>
      <td>[0.0, 0.004166666666666667, 2.0015625]</td>
      <td>[75.0, 120.0, 75.0]</td>
      <td>174.718229</td>
      <td>True</td>
      <td>384.0</td>
      <td>[, , , , , , , , , , , , , , , ]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/2f02103cfb1764e661d54151...</td>
    </tr>
    <tr>
      <th>39942</th>
      <td>../datasets/lmd/lmd_full/6/609b19dde84d2374b7d...</td>
      <td>False</td>
      <td>237.529957</td>
      <td>[0.0, 0.0026041666666666665]</td>
      <td>[120.0, 110.00091667430561]</td>
      <td>254.776049</td>
      <td>True</td>
      <td>384.0</td>
      <td>[S-File, S-File, S-File, S-File, S-File, S-Fil...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/609b19dde84d2374b7d19124...</td>
    </tr>
    <tr>
      <th>100593</th>
      <td>../datasets/lmd/lmd_full/d/de4dde0f1e960e41360...</td>
      <td>False</td>
      <td>170.384180</td>
      <td>[0.0, 3.0, 183.33574275, 183.66386775]</td>
      <td>[120.0, 67.00002903334591, 60.0, 49.0000318500...</td>
      <td>190.137078</td>
      <td>False</td>
      <td>192.0</td>
      <td>[, , , , , ]</td>
      <td>0.0</td>
      <td>../datasets/lmd/proto/de4dde0f1e960e413602c493...</td>
    </tr>
    <tr>
      <th>44272</th>
      <td>../datasets/lmd/lmd_full/6/6f74186f4c163863630...</td>
      <td>False</td>
      <td>242.119770</td>
      <td>[0.0]</td>
      <td>[122.00006913337249]</td>
      <td>228.161756</td>
      <td>True</td>
      <td>480.0</td>
      <td>[drummix, bass, ac piano, Vocal, back voc, ac ...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/6f74186f4c163863630e8baa...</td>
    </tr>
    <tr>
      <th>15131</th>
      <td>../datasets/lmd/lmd_full/0/0d8e9c4eb761a3e632b...</td>
      <td>False</td>
      <td>245.724188</td>
      <td>[0.0, 3.9344240000000004, 14.843497999999999, ...</td>
      <td>[122.00006913337249, 121.00018755029072, 123.0...</td>
      <td>251.814031</td>
      <td>True</td>
      <td>96.0</td>
      <td>[TAKE ME HOME                    Bextor/Aller/...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/0d8e9c4eb761a3e632ba4f10...</td>
    </tr>
    <tr>
      <th>34735</th>
      <td>../datasets/lmd/lmd_full/6/6d3149b41d088c63627...</td>
      <td>False</td>
      <td>84.000025</td>
      <td>[0.0, 89.2856875, 89.88351320833333, 90.410473...</td>
      <td>[42.00001260000378, 46.00002913335179, 51.0000...</td>
      <td>340.282369</td>
      <td>False</td>
      <td>96.0</td>
      <td>[Voice (Alto), Voice (Alto), Voice (Alto), Pia...</td>
      <td>6.0</td>
      <td>../datasets/lmd/proto/6d3149b41d088c6362792faf...</td>
    </tr>
    <tr>
      <th>45905</th>
      <td>../datasets/lmd/lmd_full/1/1a931072e21340f256b...</td>
      <td>False</td>
      <td>207.446994</td>
      <td>[0.0]</td>
      <td>[120.0]</td>
      <td>280.114583</td>
      <td>True</td>
      <td>384.0</td>
      <td>[A.PIANO 1, FINGERDBAS, A.PIANO 1, PAN FLUTE, ...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/1a931072e21340f256b96104...</td>
    </tr>
    <tr>
      <th>12844</th>
      <td>../datasets/lmd/lmd_full/0/0a7c38887ba4882921e...</td>
      <td>False</td>
      <td>224.582071</td>
      <td>[0.0]</td>
      <td>[127.96996971377385]</td>
      <td>193.497545</td>
      <td>True</td>
      <td>480.0</td>
      <td>[CANDOMBE, PARA, GARDEL, http://fberni.tripod....</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/0a7c38887ba4882921ee2c82...</td>
    </tr>
    <tr>
      <th>114123</th>
      <td>../datasets/lmd/lmd_full/4/455fcb4f4c5ad4d10da...</td>
      <td>False</td>
      <td>153.020774</td>
      <td>[0.0, 7.15475625, 7.3302190000000005, 7.506771...</td>
      <td>[85.95680670463092, 85.48823040787859, 84.9608...</td>
      <td>100.750126</td>
      <td>False</td>
      <td>1024.0</td>
      <td>[]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/455fcb4f4c5ad4d10da384b6...</td>
    </tr>
    <tr>
      <th>14339</th>
      <td>../datasets/lmd/lmd_full/0/029c4baa3089eca3817...</td>
      <td>False</td>
      <td>199.999987</td>
      <td>[0.0, 6.461539, 7.961539, 9.790110733333334, 9...</td>
      <td>[64.99999458333379, 40.0, 69.99998833333528, 6...</td>
      <td>330.377789</td>
      <td>True</td>
      <td>120.0</td>
      <td>[, Bass, Bass, Strings, Melodia, Slowstrings, ...</td>
      <td>5.0</td>
      <td>../datasets/lmd/proto/029c4baa3089eca381772e2b...</td>
    </tr>
    <tr>
      <th>131099</th>
      <td>../datasets/lmd/lmd_full/3/353116ea8d2eb4041c9...</td>
      <td>False</td>
      <td>260.000260</td>
      <td>[0.0]</td>
      <td>[130.00013000013]</td>
      <td>51.692256</td>
      <td>True</td>
      <td>96.0</td>
      <td>[MIDI Ch. 1, MIDI Ch. 2, MIDI Drums]</td>
      <td>0.0</td>
      <td>../datasets/lmd/proto/353116ea8d2eb4041c9f4622...</td>
    </tr>
    <tr>
      <th>124606</th>
      <td>../datasets/lmd/lmd_full/3/3574baf9f9cdfa4c3e1...</td>
      <td>False</td>
      <td>207.262310</td>
      <td>[0.0, 0.16129033333333334, 0.9425403333333333,...</td>
      <td>[30.999997933333468, 32.0, 32.99999670000033, ...</td>
      <td>273.626126</td>
      <td>True</td>
      <td>120.0</td>
      <td>[Rhodes Piano, Synth Bass H, Synth Bass L, Aco...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/3574baf9f9cdfa4c3e1da456...</td>
    </tr>
    <tr>
      <th>136078</th>
      <td>../datasets/lmd/lmd_full/e/eb59c9f6854d897a03a...</td>
      <td>False</td>
      <td>193.775528</td>
      <td>[0.0, 3.5416666666666665]</td>
      <td>[120.0, 109.99990833340973]</td>
      <td>217.860027</td>
      <td>True</td>
      <td>240.0</td>
      <td>[Bass / Acoustic bass, Piano / Rhodes, Melody ...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/eb59c9f6854d897a03a3ed78...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We now also add the original file names from the md5 json file to our dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">original_files</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">midi_path</span> <span class="ow">in</span> <span class="n">midi_df</span><span class="p">[</span><span class="s1">&#39;midi_path&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="n">midi_name</span> <span class="o">=</span> <span class="n">midi_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">original_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">md5_filenames</span><span class="p">[</span><span class="n">midi_name</span><span class="p">])</span>

<span class="n">midi_df</span><span class="p">[</span><span class="s1">&#39;original_files&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">original_files</span>

<span class="n">midi_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>midi_path</th>
      <th>midi_error</th>
      <th>estimate_tempo</th>
      <th>tempi_sec</th>
      <th>tempi</th>
      <th>end_time</th>
      <th>drums</th>
      <th>resolution</th>
      <th>instrument_names</th>
      <th>num_time_signature_changes</th>
      <th>proto_path</th>
      <th>original_files</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>31900</th>
      <td>../datasets/lmd/lmd_full/7/745f66980de9ca27fe0...</td>
      <td>False</td>
      <td>169.981663</td>
      <td>[0.0]</td>
      <td>[151.00037750094376]</td>
      <td>141.733917</td>
      <td>True</td>
      <td>96.0</td>
      <td>[Acc Bass, Piano, Melody, Sax, Solo, E.Guitar,...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/745f66980de9ca27fe055cc6...</td>
      <td>[BonJovi/Runaway3.mid, MikeDoyle/MyLittleRunAw...</td>
    </tr>
    <tr>
      <th>33585</th>
      <td>../datasets/lmd/lmd_full/6/68b145d7ffdf4c43e1f...</td>
      <td>False</td>
      <td>204.472843</td>
      <td>[0.0]</td>
      <td>[99.99999999999999]</td>
      <td>163.656250</td>
      <td>True</td>
      <td>96.0</td>
      <td>[Remelexo, Remelexo, Remelexo, Remelexo, Remel...</td>
      <td>2.0</td>
      <td>../datasets/lmd/proto/68b145d7ffdf4c43e1f5f59c...</td>
      <td>[C/Cesar E Paulinho - Remelexo.mid, Midis Româ...</td>
    </tr>
    <tr>
      <th>67436</th>
      <td>../datasets/lmd/lmd_full/a/a373ed7cd11fb80fac3...</td>
      <td>False</td>
      <td>159.432272</td>
      <td>[0.0]</td>
      <td>[159.0002067002687]</td>
      <td>154.150743</td>
      <td>True</td>
      <td>192.0</td>
      <td>[Crash Cymbal, Ride Cymbal, Open HiHat, Closed...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/a373ed7cd11fb80fac3dca06...</td>
      <td>[t/trust_me.mid, T/trust_me.mid]</td>
    </tr>
    <tr>
      <th>142153</th>
      <td>../datasets/lmd/lmd_full/e/ec2fff2c295943aedf4...</td>
      <td>False</td>
      <td>194.483086</td>
      <td>[0.0]</td>
      <td>[88.70005632453577]</td>
      <td>259.977287</td>
      <td>True</td>
      <td>120.0</td>
      <td>[You Can Leave Your Hat On, You Can Leave Your...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/ec2fff2c295943aedf4797c3...</td>
      <td>[Y/You Can Leave Your Hat on Pm L.mid, Y/You C...</td>
    </tr>
    <tr>
      <th>127493</th>
      <td>../datasets/lmd/lmd_full/3/3fae950c18f739286ec...</td>
      <td>False</td>
      <td>160.190137</td>
      <td>[0.0]</td>
      <td>[160.0]</td>
      <td>100.425000</td>
      <td>True</td>
      <td>480.0</td>
      <td>[Sax, Sax, French Horn, Piano, Bass, Drums]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/3fae950c18f739286ec42107...</td>
      <td>[2009 MIDI/barbra_Ann2-Regents-F160.mid]</td>
    </tr>
    <tr>
      <th>138301</th>
      <td>../datasets/lmd/lmd_full/e/ec16ec22a846e4d4d91...</td>
      <td>False</td>
      <td>164.382517</td>
      <td>[0.0, 186.66648]</td>
      <td>[162.000162000162, 120.0]</td>
      <td>186.666480</td>
      <td>True</td>
      <td>120.0</td>
      <td>[Vocal, ElecGtr 1, ElecGtr 2, PickedBass, Orga...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/ec16ec22a846e4d4d91959cc...</td>
      <td>[c/chaingm.mid, C/chaingm.mid]</td>
    </tr>
    <tr>
      <th>83006</th>
      <td>../datasets/lmd/lmd_full/f/fd8a6fcf912a7ddc602...</td>
      <td>False</td>
      <td>160.171123</td>
      <td>[0.0]</td>
      <td>[80.0]</td>
      <td>274.525000</td>
      <td>True</td>
      <td>120.0</td>
      <td>[Corazon Partio, Corazon Partio, Corazon Parti...</td>
      <td>7.0</td>
      <td>../datasets/lmd/proto/fd8a6fcf912a7ddc60242146...</td>
      <td>[C/Corazon Partio Pm L.mid, Midis Latinas/Cora...</td>
    </tr>
    <tr>
      <th>13575</th>
      <td>../datasets/lmd/lmd_full/0/0dff276c070ccc16e2b...</td>
      <td>False</td>
      <td>203.014003</td>
      <td>[0.0]</td>
      <td>[190.0002850004275]</td>
      <td>48.976900</td>
      <td>True</td>
      <td>96.0</td>
      <td>[Bop on the Rocks, Bop on the Rocks, Bop on th...</td>
      <td>3.0</td>
      <td>../datasets/lmd/proto/0dff276c070ccc16e2bd6fa1...</td>
      <td>[Jazz/Bop on.mid, b/bop-on.mid, Jazz/BOP_ON.MI...</td>
    </tr>
    <tr>
      <th>134536</th>
      <td>../datasets/lmd/lmd_full/e/ed793dadf58b913ea24...</td>
      <td>False</td>
      <td>192.000192</td>
      <td>[0.0]</td>
      <td>[140.00014000014]</td>
      <td>6.861600</td>
      <td>False</td>
      <td>96.0</td>
      <td>[z3ta+ (MIDI)]</td>
      <td>0.0</td>
      <td>../datasets/lmd/proto/ed793dadf58b913ea2460ad1...</td>
      <td>[M/Machinehead - Headwave (Zatox Mix).mid, M/M...</td>
    </tr>
    <tr>
      <th>116286</th>
      <td>../datasets/lmd/lmd_full/4/4c4d48e046e6f5a2fc2...</td>
      <td>False</td>
      <td>255.499940</td>
      <td>[0.0]</td>
      <td>[145.9999659333413]</td>
      <td>6.575344</td>
      <td>False</td>
      <td>96.0</td>
      <td>[MIDI out]</td>
      <td>0.0</td>
      <td>../datasets/lmd/proto/4c4d48e046e6f5a2fc2f89cb...</td>
      <td>[J/jan_johnston__flesh__tilt_remix__bamford.mi...</td>
    </tr>
    <tr>
      <th>126553</th>
      <td>../datasets/lmd/lmd_full/3/312b4e4b6f9bbd3abe3...</td>
      <td>False</td>
      <td>192.617363</td>
      <td>[0.0]</td>
      <td>[96.0]</td>
      <td>87.500000</td>
      <td>True</td>
      <td>384.0</td>
      <td>[ACOU BASS, A.PIANO 1, A.PIANO 1, JAZZ GTR, SL...</td>
      <td>2.0</td>
      <td>../datasets/lmd/proto/312b4e4b6f9bbd3abe3af2bb...</td>
      <td>[Diversen/Strike-Up-The-Band.mid, DIVERSEN/STR...</td>
    </tr>
    <tr>
      <th>150997</th>
      <td>../datasets/lmd/lmd_full/b/bf3f61d4bf0c7a99c7c...</td>
      <td>False</td>
      <td>196.007331</td>
      <td>[0.0]</td>
      <td>[98.0036653370836]</td>
      <td>364.744011</td>
      <td>True</td>
      <td>384.0</td>
      <td>[SHOUT, SHOUT, SHOUT, SHOUT, SHOUT, SHOUT, SHO...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/bf3f61d4bf0c7a99c7c5dded...</td>
      <td>[080/Shout.mid, 080/Shout.mid]</td>
    </tr>
    <tr>
      <th>66108</th>
      <td>../datasets/lmd/lmd_full/8/80fd25fb1ff70896ed8...</td>
      <td>False</td>
      <td>180.717774</td>
      <td>[0.0, 0.008333333333333333, 11.500865666666666...</td>
      <td>[60.0, 67.00002903334591, 65.99999340000066, 6...</td>
      <td>109.561609</td>
      <td>False</td>
      <td>120.0</td>
      <td>[English (open lyrics window), French (open ly...</td>
      <td>16.0</td>
      <td>../datasets/lmd/proto/80fd25fb1ff70896ed8b1115...</td>
      <td>[R/Ravel Maurice Chanson Des Cueilleuses De Le...</td>
    </tr>
    <tr>
      <th>5427</th>
      <td>../datasets/lmd/lmd_full/9/91100d1888462c59031...</td>
      <td>False</td>
      <td>246.623850</td>
      <td>[0.0]</td>
      <td>[120.0]</td>
      <td>32.005208</td>
      <td>False</td>
      <td>480.0</td>
      <td>[Nylon-Str. Gt., Bass, *Piano, Warm Pad, Strings]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/91100d1888462c5903132be8...</td>
      <td>[COREL COLLECTION/MOOD_06.MID]</td>
    </tr>
    <tr>
      <th>78360</th>
      <td>../datasets/lmd/lmd_full/f/f577f833d678672ef3b...</td>
      <td>False</td>
      <td>194.594595</td>
      <td>[0.0]</td>
      <td>[120.0]</td>
      <td>200.916667</td>
      <td>True</td>
      <td>384.0</td>
      <td>[Snare / Tom/cymbal, Snare / Tom/cymbal, Snare...</td>
      <td>3.0</td>
      <td>../datasets/lmd/proto/f577f833d678672ef3b2787c...</td>
      <td>[D/Double Vision.mid, D/Double Vision.mid, D/D...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="analysis-of-metadata">
<h2>Analysis of metadata<a class="headerlink" href="#analysis-of-metadata" title="Permalink to this headline">¶</a></h2>
<p>Lets examine the extracted metadata of those files.
Before we start plotting its always a good idea to take a look a the dataframe and its description.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>midi_path</th>
      <th>midi_error</th>
      <th>estimate_tempo</th>
      <th>tempi_sec</th>
      <th>tempi</th>
      <th>end_time</th>
      <th>drums</th>
      <th>resolution</th>
      <th>instrument_names</th>
      <th>num_time_signature_changes</th>
      <th>proto_path</th>
      <th>original_files</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>160813</th>
      <td>../datasets/lmd/lmd_full/2/2b03576c2eac6b20c55...</td>
      <td>False</td>
      <td>220.504202</td>
      <td>[0.0]</td>
      <td>[99.99999999999999]</td>
      <td>200.200000</td>
      <td>True</td>
      <td>384.0</td>
      <td>[Lead, Bass, Guitar, Rhythm guitar, Voice oohs...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/2b03576c2eac6b20c5537514...</td>
      <td>[M/Monday Monday.mid]</td>
    </tr>
    <tr>
      <th>83189</th>
      <td>../datasets/lmd/lmd_full/f/fc7280752baa136165c...</td>
      <td>False</td>
      <td>149.380190</td>
      <td>[0.0]</td>
      <td>[160.01024065540196]</td>
      <td>150.326316</td>
      <td>True</td>
      <td>48.0</td>
      <td>[SYNTH, SYNTH, SYNTH, SYNTH, SYNTH, SYNTH, SYN...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/fc7280752baa136165c911e0...</td>
      <td>[e/entreaty.mid]</td>
    </tr>
    <tr>
      <th>96858</th>
      <td>../datasets/lmd/lmd_full/c/cb226a46053507ae8a4...</td>
      <td>False</td>
      <td>170.000085</td>
      <td>[0.0]</td>
      <td>[170.0000850000425]</td>
      <td>11.294112</td>
      <td>False</td>
      <td>96.0</td>
      <td>[Neo Cortex - Elements (Styles &amp; Breeze Remix)]</td>
      <td>0.0</td>
      <td>../datasets/lmd/proto/cb226a46053507ae8a47a16c...</td>
      <td>[N/Neo Cortex - Elements (Breeze &amp; Styles Remi...</td>
    </tr>
    <tr>
      <th>34038</th>
      <td>../datasets/lmd/lmd_full/6/6d12ce4d832f9c39ca6...</td>
      <td>False</td>
      <td>231.914925</td>
      <td>[0.0, 2.368422, 3.493422, 11.1907935, 11.19735...</td>
      <td>[151.99993920002433, 80.0, 151.99993920002433,...</td>
      <td>503.284151</td>
      <td>False</td>
      <td>120.0</td>
      <td>[Primo RH, Primo LH G, Primo LH F, Secondo RH ...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/6d12ce4d832f9c39ca683d53...</td>
      <td>[Mendelsonn/Allegro Brillant for Piano 4-hands...</td>
    </tr>
    <tr>
      <th>171000</th>
      <td>../datasets/lmd/lmd_full/5/586c46e8f1c65beff59...</td>
      <td>False</td>
      <td>236.159582</td>
      <td>[0.0]</td>
      <td>[130.0023833770286]</td>
      <td>91.378132</td>
      <td>True</td>
      <td>384.0</td>
      <td>[ACCORDION, A.PIANO 1, FINGERDBAS, CRYSTAL, DR...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/586c46e8f1c65beff59afe0b...</td>
      <td>[Byrd, Charlie/The-Girl-From-Ipanema.mid, BYRD...</td>
    </tr>
    <tr>
      <th>103720</th>
      <td>../datasets/lmd/lmd_full/d/dabbeaf50e6bad0b54d...</td>
      <td>True</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>[Sure.Polyphone.Midi/Entertainer.mid, Various ...</td>
    </tr>
    <tr>
      <th>71588</th>
      <td>../datasets/lmd/lmd_full/a/aaf2e0398a707b34bbe...</td>
      <td>False</td>
      <td>174.928646</td>
      <td>[0.0]</td>
      <td>[124.000248000496]</td>
      <td>131.612640</td>
      <td>True</td>
      <td>384.0</td>
      <td>[ESTCE PR HASARD, ESTCE PR HASARD, ESTCE PR HA...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/aaf2e0398a707b34bbeaefb9...</td>
      <td>[E/Est Ce Par Hasard Dave.mid]</td>
    </tr>
    <tr>
      <th>139917</th>
      <td>../datasets/lmd/lmd_full/e/ebc5edd3c533092d324...</td>
      <td>False</td>
      <td>196.431974</td>
      <td>[0.0]</td>
      <td>[85.00028333427778]</td>
      <td>276.574446</td>
      <td>True</td>
      <td>384.0</td>
      <td>[TORN, TORN, TORN, TORN, TORN, TORN, TORN, TOR...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/ebc5edd3c533092d32461eee...</td>
      <td>[X/Xgtorn.mid, 097/XGtorn.mid, 097/XGtorn.mid]</td>
    </tr>
    <tr>
      <th>45209</th>
      <td>../datasets/lmd/lmd_full/1/1450ab4b1e52e25438d...</td>
      <td>False</td>
      <td>195.096618</td>
      <td>[0.0]</td>
      <td>[107.9999136000691]</td>
      <td>224.166846</td>
      <td>False</td>
      <td>96.0</td>
      <td>[Soprano, Soprano, Soprano, Soprano, Soprano, ...</td>
      <td>38.0</td>
      <td>../datasets/lmd/proto/1450ab4b1e52e25438de8e7e...</td>
      <td>[civilwar2/61sfttobfa.mid]</td>
    </tr>
    <tr>
      <th>74319</th>
      <td>../datasets/lmd/lmd_full/a/aae666057efdbc7268d...</td>
      <td>False</td>
      <td>240.000000</td>
      <td>[0.0]</td>
      <td>[120.0]</td>
      <td>66.010417</td>
      <td>False</td>
      <td>96.0</td>
      <td>[3xOsc (MIDI), 3xOsc #2 (MIDI), 3xOsc #3 (MIDI...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/aae666057efdbc7268d62b8f...</td>
      <td>[K/Kara_Sun_-_Into_The_Sun_(Airbase_Dub_Mix)__...</td>
    </tr>
    <tr>
      <th>90199</th>
      <td>../datasets/lmd/lmd_full/c/c750e5a017155f06e63...</td>
      <td>False</td>
      <td>256.000000</td>
      <td>[0.0]</td>
      <td>[128.0]</td>
      <td>15.117188</td>
      <td>False</td>
      <td>96.0</td>
      <td>[Sylenth1 4, Sylenth1 3, Sylenth1 1]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/c750e5a017155f06e63ae69c...</td>
      <td>[C/Cascada_-_BadBoy__DjMixdOut_20130211014527....</td>
    </tr>
    <tr>
      <th>99470</th>
      <td>../datasets/lmd/lmd_full/c/cc6b412aeeb834e8fec...</td>
      <td>False</td>
      <td>275.408685</td>
      <td>[0.0, 182.14267500000003]</td>
      <td>[140.00014000014, 108.99994368336242]</td>
      <td>185.995888</td>
      <td>True</td>
      <td>120.0</td>
      <td>[, , , , , , , , , , ]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/cc6b412aeeb834e8fecfd308...</td>
      <td>[VerucaSalt/Seether.mid, VerucaSalt/Seether.mi...</td>
    </tr>
    <tr>
      <th>175912</th>
      <td>../datasets/lmd/lmd_full/5/500a1212bae787f7ef8...</td>
      <td>False</td>
      <td>240.000000</td>
      <td>[0.0]</td>
      <td>[120.0]</td>
      <td>98.494792</td>
      <td>False</td>
      <td>384.0</td>
      <td>[The Flowers, Of The Heath, Sequenced By, Barr...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/500a1212bae787f7ef8fb099...</td>
      <td>[h/heath.mid, H/heath.mid]</td>
    </tr>
    <tr>
      <th>30403</th>
      <td>../datasets/lmd/lmd_full/7/7dc2e8000f630ab4e57...</td>
      <td>False</td>
      <td>200.644292</td>
      <td>[0.0, 9.69696, 38.49696, 48.193920000000006, 5...</td>
      <td>[198.000198000198, 199.99999999999997, 198.000...</td>
      <td>144.326112</td>
      <td>True</td>
      <td>384.0</td>
      <td>[Drums - Travis, Bass - Mark, Guitar 1 - Tom, ...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/7dc2e8000f630ab4e57eebd5...</td>
      <td>[B/blink_182-dumpweed.mid]</td>
    </tr>
    <tr>
      <th>108557</th>
      <td>../datasets/lmd/lmd_full/d/d864a2adc13ad8b9797...</td>
      <td>False</td>
      <td>251.560269</td>
      <td>[0.0]</td>
      <td>[126.99998518333504]</td>
      <td>205.980339</td>
      <td>True</td>
      <td>120.0</td>
      <td>[The Corrs, "Breathless", , ****************, ...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/d864a2adc13ad8b9797d6be2...</td>
      <td>[Corrs/The Corrs - Breathless.mid, Various/The...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 178561 entries, 0 to 178560
Data columns (total 12 columns):
 #   Column                      Non-Null Count   Dtype  
---  ------                      --------------   -----  
 0   midi_path                   178561 non-null  object 
 1   midi_error                  178561 non-null  bool   
 2   estimate_tempo              173980 non-null  float64
 3   tempi_sec                   173980 non-null  object 
 4   tempi                       173980 non-null  object 
 5   end_time                    173980 non-null  float64
 6   drums                       173980 non-null  object 
 7   resolution                  173980 non-null  float64
 8   instrument_names            173980 non-null  object 
 9   num_time_signature_changes  173980 non-null  float64
 10  proto_path                  174472 non-null  object 
 11  original_files              178561 non-null  object 
dtypes: bool(1), float64(4), object(7)
memory usage: 15.2+ MB
</pre></div>
</div>
</div>
</div>
<p>With a pandas dataframe we can simply aggregate and plot data into different formats.
Lets start by taking a look at our success rate of parsing the MIDI files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="p">[</span><span class="s1">&#39;midi_error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pie</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Faulty MIDI files&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_60_0.png" src="../_images/01_midi_drums_60_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">midi_error</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Number of faulty MIDI files&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_61_0.png" src="../_images/01_midi_drums_61_0.png" />
</div>
</div>
<p>After we know the amount of failed MIDI files we could inspect those further to see if they are indeed corrupted or if our library has a bug.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="p">[</span><span class="n">midi_df</span><span class="p">[</span><span class="s1">&#39;midi_error&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>midi_path</th>
      <th>midi_error</th>
      <th>estimate_tempo</th>
      <th>tempi_sec</th>
      <th>tempi</th>
      <th>end_time</th>
      <th>drums</th>
      <th>resolution</th>
      <th>instrument_names</th>
      <th>num_time_signature_changes</th>
      <th>proto_path</th>
      <th>original_files</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>../datasets/lmd/lmd_full/9/911cd08fa1fae36e5e0...</td>
      <td>True</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>[s/sou.mid, S/sou.mid]</td>
    </tr>
    <tr>
      <th>24</th>
      <td>../datasets/lmd/lmd_full/9/94862530febd2b295b9...</td>
      <td>True</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>[e/ELVIS_PRESLEY__Dont_Be_Cruel.mid, ElvisPres...</td>
    </tr>
    <tr>
      <th>25</th>
      <td>../datasets/lmd/lmd_full/9/906e72809900e01f919...</td>
      <td>True</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>[dream theater/uagm1.mid]</td>
    </tr>
    <tr>
      <th>98</th>
      <td>../datasets/lmd/lmd_full/9/99e40264f321a4bfc5d...</td>
      <td>True</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>[V/vong_tay_cau_hon.mid]</td>
    </tr>
    <tr>
      <th>106</th>
      <td>../datasets/lmd/lmd_full/9/9f22ccab9572cafafce...</td>
      <td>True</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>[W/Wippenberg - Pong (Tocadisco Remix).mid, W/...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>178315</th>
      <td>../datasets/lmd/lmd_full/5/5063a2b400597a372e7...</td>
      <td>True</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>[f/faded.mid, 2009 MIDI/faded_love1-D120patsy_...</td>
    </tr>
    <tr>
      <th>178377</th>
      <td>../datasets/lmd/lmd_full/5/523ce5adc656c872a69...</td>
      <td>True</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>[l/laputa.mid, L/laputa.mid]</td>
    </tr>
    <tr>
      <th>178419</th>
      <td>../datasets/lmd/lmd_full/5/546df09d78a32141369...</td>
      <td>True</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>[h/heraldic.mid, H/heraldic.mid]</td>
    </tr>
    <tr>
      <th>178484</th>
      <td>../datasets/lmd/lmd_full/5/5a4e49112c6cf832341...</td>
      <td>True</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>[w/WESTERN.MID, 2009 MIDI/good_bad_and_ugly4-C...</td>
    </tr>
    <tr>
      <th>178525</th>
      <td>../datasets/lmd/lmd_full/5/5cae276ae00fb1fd464...</td>
      <td>True</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>NaN</td>
      <td>None</td>
      <td>[soad/Chic_N_Stu.mid]</td>
    </tr>
  </tbody>
</table>
<p>4088 rows × 12 columns</p>
</div></div></div>
</div>
<p>For now we will simply ignore those files and focus on the ones that we could sucessfully parse.</p>
<p>For our experiments it is important that the MIDI files contain a drum track - only the files we could succssfully parse and contain a drum track can be used for training of our model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">drums</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pie</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;MIDI files that contain drums&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_65_0.png" src="../_images/01_midi_drums_65_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">drums</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">();</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Number of MIDI files that contain drums&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_66_0.png" src="../_images/01_midi_drums_66_0.png" />
</div>
</div>
<p>We should verify that the files in which we did not detect any drums have indeed no drums by listening to a random subset of them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="p">[</span><span class="n">midi_df</span><span class="p">[</span><span class="s1">&#39;drums&#39;</span><span class="p">]</span><span class="o">==</span><span class="kc">False</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>midi_path</th>
      <th>midi_error</th>
      <th>estimate_tempo</th>
      <th>tempi_sec</th>
      <th>tempi</th>
      <th>end_time</th>
      <th>drums</th>
      <th>resolution</th>
      <th>instrument_names</th>
      <th>num_time_signature_changes</th>
      <th>proto_path</th>
      <th>original_files</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>148707</th>
      <td>../datasets/lmd/lmd_full/b/bf4d465e11d4a540d0f...</td>
      <td>False</td>
      <td>126.048915</td>
      <td>[0.0]</td>
      <td>[68.0000725334107]</td>
      <td>179.999808</td>
      <td>False</td>
      <td>384.0</td>
      <td>[up, down]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/bf4d465e11d4a540d0f21582...</td>
      <td>[Z/Zan Sayonara Zetsubou Sensei - Main Theme (...</td>
    </tr>
    <tr>
      <th>105806</th>
      <td>../datasets/lmd/lmd_full/d/d248b07546972ce78c4...</td>
      <td>False</td>
      <td>173.114046</td>
      <td>[0.0, 146.6161300625, 146.681537, 146.74732643...</td>
      <td>[174.00029580050287, 172.00010320006191, 171.0...</td>
      <td>149.720569</td>
      <td>False</td>
      <td>240.0</td>
      <td>[Trumpet I in D, Trumpet II in D, Trumpet III ...</td>
      <td>2.0</td>
      <td>../datasets/lmd/proto/d248b07546972ce78c4c6870...</td>
      <td>[Bwv1066-1069 Orchestral Suites/Bwv1068 Orches...</td>
    </tr>
    <tr>
      <th>121719</th>
      <td>../datasets/lmd/lmd_full/4/432aa21fd074b3fcfbe...</td>
      <td>False</td>
      <td>207.992297</td>
      <td>[0.0]</td>
      <td>[100.0]</td>
      <td>264.526250</td>
      <td>False</td>
      <td>480.0</td>
      <td>[Ethiopia]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/432aa21fd074b3fcfbe5df94...</td>
      <td>[RAGTIME/RP030.MID, R/RP030.MID]</td>
    </tr>
    <tr>
      <th>105121</th>
      <td>../datasets/lmd/lmd_full/d/dd779f6d3e3db4b26bc...</td>
      <td>False</td>
      <td>163.636527</td>
      <td>[0.0]</td>
      <td>[130.00013000013]</td>
      <td>138.965246</td>
      <td>False</td>
      <td>480.0</td>
      <td>[Pedro Sa, Pereira]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/dd779f6d3e3db4b26bc2f625...</td>
      <td>[c/chuachua.mid, C/chuachua.mid]</td>
    </tr>
    <tr>
      <th>17363</th>
      <td>../datasets/lmd/lmd_full/0/029e9ea0f8c08315866...</td>
      <td>False</td>
      <td>223.791098</td>
      <td>[0.0, 113.75, 157.749956, 163.74995, 166.416614]</td>
      <td>[96.0, 90.00009000009, 140.00014000014, 180.00...</td>
      <td>328.246041</td>
      <td>False</td>
      <td>96.0</td>
      <td>[, , , ]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/029e9ea0f8c083158664cb5c...</td>
      <td>[1/19agro2.mid, 1/19agro2.mid]</td>
    </tr>
    <tr>
      <th>5992</th>
      <td>../datasets/lmd/lmd_full/9/961acf9cb95cd22ee50...</td>
      <td>False</td>
      <td>163.121235</td>
      <td>[0.0, 5.4375, 5.817247, 6.2018625, 6.591473, 1...</td>
      <td>[80.0, 78.99996576668151, 77.99997660000702, 7...</td>
      <td>187.201926</td>
      <td>False</td>
      <td>96.0</td>
      <td>[Voice, Voice, Voice, Harp (hi), Harp (lo)]</td>
      <td>10.0</td>
      <td>../datasets/lmd/proto/961acf9cb95cd22ee50f7990...</td>
      <td>[1800s/53tbl.mid]</td>
    </tr>
    <tr>
      <th>8205</th>
      <td>../datasets/lmd/lmd_full/9/9ad04a612b27e60d609...</td>
      <td>False</td>
      <td>243.484263</td>
      <td>[0.0, 1.10137939453125, 1.43171830078125, 1.76...</td>
      <td>[128.0, 127.00025400050801, 126.000126000126, ...</td>
      <td>109.536623</td>
      <td>False</td>
      <td>1024.0</td>
      <td>[Synth Voice, Acoustic Grand Piano, Instrument...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/9ad04a612b27e60d609ecd9a...</td>
      <td>[C/Cowboy Bebop - Green Bird.mid]</td>
    </tr>
    <tr>
      <th>69212</th>
      <td>../datasets/lmd/lmd_full/a/a1c529270cbe99e8ede...</td>
      <td>False</td>
      <td>200.000000</td>
      <td>[0.0]</td>
      <td>[100.0]</td>
      <td>58.200000</td>
      <td>False</td>
      <td>256.0</td>
      <td>[]</td>
      <td>44.0</td>
      <td>../datasets/lmd/proto/a1c529270cbe99e8edefbdde...</td>
      <td>[Classical_Guitar_classicalguitarmidi.com_MIDI...</td>
    </tr>
    <tr>
      <th>85429</th>
      <td>../datasets/lmd/lmd_full/f/f4f330790558eb5ad48...</td>
      <td>False</td>
      <td>284.000142</td>
      <td>[0.0]</td>
      <td>[142.0000710000355]</td>
      <td>13.521120</td>
      <td>False</td>
      <td>480.0</td>
      <td>[Storm (Alphazone Remix)]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/f4f330790558eb5ad48d06cb...</td>
      <td>[A/Atmosphere_-_Storm_(Alphazone_Remix)__giasc...</td>
    </tr>
    <tr>
      <th>91863</th>
      <td>../datasets/lmd/lmd_full/c/c41d33ba5e35e7b9a4c...</td>
      <td>False</td>
      <td>236.552891</td>
      <td>[0.0]</td>
      <td>[121.00018755029072]</td>
      <td>199.834401</td>
      <td>False</td>
      <td>96.0</td>
      <td>[Flute, Flute, Flute, Trumpet, Harpsicord, Har...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/c41d33ba5e35e7b9a4ccbcae...</td>
      <td>[s/sonata-c.mid, S/sonata-c.mid]</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Lets take also a look at the other metadata we have extracted.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;tempi&#39;</span><span class="p">)[</span><span class="s1">&#39;tempi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">vert</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Boxplot of tempi&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_70_0.png" src="../_images/01_midi_drums_70_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;tempi&#39;</span><span class="p">)[</span><span class="s1">&#39;tempi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">));</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Histogram of tempi&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_71_0.png" src="../_images/01_midi_drums_71_0.png" />
</div>
</div>
<p>We notice a big spork at around 120 bpm which is rather interesting and should be inspected what the exact casue of this spike is.</p>
<p>It is important to have an understanding and feeling for the data.
We have an expectation of our data which can help us to see if the data makes sense and if we parsed it correctly but can also always be problematic because we project certain expectations on an projection and simplification of our data.</p>
<p>We can also count the occurences of tempi changes on songs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;tempi&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;midi_path&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">vert</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Boxplot of number of time chages per song&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_73_0.png" src="../_images/01_midi_drums_73_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;tempi&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;midi_path&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>midi_path
../datasets/lmd/lmd_full/9/95cf26881a51f376a54e4e3f049f2d48.mid    6597
../datasets/lmd/lmd_full/3/34c04cd56b1087851f79780360f48225.mid    6096
../datasets/lmd/lmd_full/2/2677cf785791e1cfca13a0566aafbc85.mid    6096
../datasets/lmd/lmd_full/3/34a3df2a3a1e2267cf63657984f608cf.mid    5912
../datasets/lmd/lmd_full/c/c615436a609bf4e82c102503ea01d855.mid    5758
../datasets/lmd/lmd_full/1/1e40fd0edc293c8733a9c1b66517890b.mid    5758
../datasets/lmd/lmd_full/6/6662d98153d0c84d93e794d0c2b3940f.mid    5758
../datasets/lmd/lmd_full/8/8d956a0e5ee409a19adda9db287f7108.mid    4301
../datasets/lmd/lmd_full/0/001549d8bc6ba6dc62ade443cf01a51e.mid    4058
../datasets/lmd/lmd_full/0/0b0fdfe28eb0318ea3ac86046053724b.mid    3922
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Its worth to inspect those files in e.g. <a class="reference external" href="https://musescore.org/de">MuseScore</a> and try to figure out what exactly happens in thos files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="p">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">vert</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Boxplot of end_time&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_76_0.png" src="../_images/01_midi_drums_76_0.png" />
</div>
</div>
<p>We see that the <code class="docutils literal notranslate"><span class="pre">end_time</span></code> has some extreme values that are probably wrong - lets inspect those examples closer to see if we can see a pattern.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;end_time&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>midi_path</th>
      <th>midi_error</th>
      <th>estimate_tempo</th>
      <th>tempi_sec</th>
      <th>tempi</th>
      <th>end_time</th>
      <th>drums</th>
      <th>resolution</th>
      <th>instrument_names</th>
      <th>num_time_signature_changes</th>
      <th>proto_path</th>
      <th>original_files</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>84737</th>
      <td>../datasets/lmd/lmd_full/f/f7b41341a20201f860c...</td>
      <td>False</td>
      <td>225.041860</td>
      <td>[0.0]</td>
      <td>[128.0]</td>
      <td>31055.625000</td>
      <td>False</td>
      <td>120.0</td>
      <td>[Melody, On the Sun Road, Vivian Lai, Joseph L...</td>
      <td>2.0</td>
      <td>../datasets/lmd/proto/f7b41341a20201f860cb375e...</td>
      <td>[s/sunroad.mid, S/sunroad.mid]</td>
    </tr>
    <tr>
      <th>28204</th>
      <td>../datasets/lmd/lmd_full/7/7abab3566b77073f827...</td>
      <td>False</td>
      <td>220.109820</td>
      <td>[0.0, 1.411764, 67.095876, 129.0154569375, 129...</td>
      <td>[170.0000850000425, 95.00014250021376, 70.0000...</td>
      <td>25714.187790</td>
      <td>True</td>
      <td>96.0</td>
      <td>[, , , , , , , ]</td>
      <td>9.0</td>
      <td>../datasets/lmd/proto/7abab3566b77073f8274c097...</td>
      <td>[FErnszt/Olala.mid]</td>
    </tr>
    <tr>
      <th>69901</th>
      <td>../datasets/lmd/lmd_full/a/af6b689cfbb13c302bd...</td>
      <td>False</td>
      <td>229.041171</td>
      <td>[0.0, 5.052624, 40.420992, 94.420992, 118.4209...</td>
      <td>[95.00014250021376, 190.0002850004275, 80.0, 1...</td>
      <td>20384.791244</td>
      <td>True</td>
      <td>96.0</td>
      <td>[Acoustic Bass, Brass, Grand piano, Rock Organ...</td>
      <td>7.0</td>
      <td>../datasets/lmd/proto/af6b689cfbb13c302bd41b86...</td>
      <td>[FErnszt/Swingin.mid]</td>
    </tr>
    <tr>
      <th>26973</th>
      <td>../datasets/lmd/lmd_full/7/73f4f536d3d42293bd7...</td>
      <td>False</td>
      <td>144.311366</td>
      <td>[0.0]</td>
      <td>[122.00006913337249]</td>
      <td>19652.447880</td>
      <td>True</td>
      <td>192.0</td>
      <td>[tk1, tk2, tk3, tk4, tk10, tk11]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/73f4f536d3d42293bd789b34...</td>
      <td>[Clapton Eric/Bellbottom Blues.mid, Various Ar...</td>
    </tr>
    <tr>
      <th>24515</th>
      <td>../datasets/lmd/lmd_full/7/7486b07d9a4060fa614...</td>
      <td>False</td>
      <td>181.059483</td>
      <td>[0.0, 0.4829544166666666, 1.9996389166666664, ...</td>
      <td>[88.00002346667293, 89.00994241056726, 90.0099...</td>
      <td>19623.803343</td>
      <td>True</td>
      <td>192.0</td>
      <td>[Steel Str.Guitar, Fretless Bass, Piano, Violi...</td>
      <td>13.0</td>
      <td>../datasets/lmd/proto/7486b07d9a4060fa6142ac46...</td>
      <td>[K/Kevin Parent Les Doigts 2.mid]</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Regarding this it seems we should filter out those really long pieces as those are most probably wrong files.</p>
<p>Those errors could be caused by our parsing or by the MIDI files itself - but as we have a big enough corpora it is justifiable by not including those outliers.</p>
<p>Resolution corresponds to the <a class="reference external" href="https://en.wikipedia.org/wiki/Pulses_per_quarter_note">PPQN</a> of the MIDI file.
Everything above 1000 should be suspicious, so lets take a look at those examples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;resolution&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>midi_path</th>
      <th>midi_error</th>
      <th>estimate_tempo</th>
      <th>tempi_sec</th>
      <th>tempi</th>
      <th>end_time</th>
      <th>drums</th>
      <th>resolution</th>
      <th>instrument_names</th>
      <th>num_time_signature_changes</th>
      <th>proto_path</th>
      <th>original_files</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>33871</th>
      <td>../datasets/lmd/lmd_full/6/610987ebaf0a326db40...</td>
      <td>False</td>
      <td>239.221606</td>
      <td>[0.0]</td>
      <td>[120.0]</td>
      <td>135.368840</td>
      <td>False</td>
      <td>25000.0</td>
      <td>[, , , ]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/610987ebaf0a326db4089867...</td>
      <td>[b/beethovenalladanza.mid, B/beethovenalladanz...</td>
    </tr>
    <tr>
      <th>45187</th>
      <td>../datasets/lmd/lmd_full/1/1283eddbc4ab9042dcc...</td>
      <td>False</td>
      <td>225.608072</td>
      <td>[0.0]</td>
      <td>[112.00005973336519]</td>
      <td>79.280092</td>
      <td>True</td>
      <td>24576.0</td>
      <td>[, , ]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/1283eddbc4ab9042dccaea09...</td>
      <td>[Pop_and_Top40/2 Pac - Changes.mid, Pop_and_To...</td>
    </tr>
    <tr>
      <th>67351</th>
      <td>../datasets/lmd/lmd_full/a/a5c6eb45c94d84474cb...</td>
      <td>False</td>
      <td>235.213491</td>
      <td>[0.0]</td>
      <td>[120.0]</td>
      <td>26.987488</td>
      <td>False</td>
      <td>16384.0</td>
      <td>[, , ]</td>
      <td>2.0</td>
      <td>../datasets/lmd/proto/a5c6eb45c94d84474cbe00a3...</td>
      <td>[a/amigo3.mid, A/amigo3.mid]</td>
    </tr>
    <tr>
      <th>159033</th>
      <td>../datasets/lmd/lmd_full/2/2076f0fa330be484c1c...</td>
      <td>False</td>
      <td>236.923314</td>
      <td>[0.0]</td>
      <td>[140.00014000014]</td>
      <td>26.999973</td>
      <td>False</td>
      <td>15360.0</td>
      <td>[Main Lead]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/2076f0fa330be484c1c60242...</td>
      <td>[M/M.I.D.O.R. - Far East.mid, M/m.i.d.o.r.__fa...</td>
    </tr>
    <tr>
      <th>15472</th>
      <td>../datasets/lmd/lmd_full/0/0c3f038f4eaed7d7f8c...</td>
      <td>False</td>
      <td>272.000290</td>
      <td>[0.0]</td>
      <td>[136.0001450668214]</td>
      <td>28.014676</td>
      <td>False</td>
      <td>15360.0</td>
      <td>[Melody]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/0c3f038f4eaed7d7f8c90478...</td>
      <td>[W/whiteroom__someday_intro__ambia.mid, W/Whit...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Another important metric is the number of time signatures.</p>
<p>If we use a step-sequencer like approach for our data we will need our data to have exactly one time signature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="p">[</span><span class="s1">&#39;num_time_signature_changes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">box</span><span class="p">(</span><span class="n">vert</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_83_0.png" src="../_images/01_midi_drums_83_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;num_time_signature_changes&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>midi_path</th>
      <th>midi_error</th>
      <th>estimate_tempo</th>
      <th>tempi_sec</th>
      <th>tempi</th>
      <th>end_time</th>
      <th>drums</th>
      <th>resolution</th>
      <th>instrument_names</th>
      <th>num_time_signature_changes</th>
      <th>proto_path</th>
      <th>original_files</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>72284</th>
      <td>../datasets/lmd/lmd_full/a/a85612fb0992100bded...</td>
      <td>False</td>
      <td>222.143725</td>
      <td>[0.0, 1.54624, 1.6513706666666668, 1.779370666...</td>
      <td>[194.0190397350993, 190.23944805194805, 195.31...</td>
      <td>204.310165</td>
      <td>True</td>
      <td>48.0</td>
      <td>[STRAUSS, STRAUSS, STRAUSS, STRAUSS, STRAUSS, ...</td>
      <td>959.0</td>
      <td>../datasets/lmd/proto/a85612fb0992100bded76798...</td>
      <td>[S/STRAUSS.MID, S/STRAUSS.MID]</td>
    </tr>
    <tr>
      <th>26776</th>
      <td>../datasets/lmd/lmd_full/7/7d42a95293cc47bcacf...</td>
      <td>False</td>
      <td>199.481296</td>
      <td>[0.0, 1.6240640000000002, 2.071552, 2.22173866...</td>
      <td>[160.0922131147541, 134.08180778032036, 133.16...</td>
      <td>229.441685</td>
      <td>True</td>
      <td>48.0</td>
      <td>[NACHT, NACHT, NACHT, NACHT, NACHT, NACHT, NACHT]</td>
      <td>782.0</td>
      <td>../datasets/lmd/proto/7d42a95293cc47bcacfaa568...</td>
      <td>[Hollands/NACHT.MID]</td>
    </tr>
    <tr>
      <th>168045</th>
      <td>../datasets/lmd/lmd_full/5/5693291bc82548fea37...</td>
      <td>False</td>
      <td>242.258977</td>
      <td>[0.0]</td>
      <td>[136.0001450668214]</td>
      <td>255.266272</td>
      <td>True</td>
      <td>96.0</td>
      <td>[VIBRA SLAP, VIBRA SLAP, VIBRA SLAP, VIBRA SLA...</td>
      <td>479.0</td>
      <td>../datasets/lmd/proto/5693291bc82548fea376ec42...</td>
      <td>[S/Striving.MID, Midis Diversas/STRIVING.MID, ...</td>
    </tr>
    <tr>
      <th>60293</th>
      <td>../datasets/lmd/lmd_full/8/85b2d4e8637008f6b4e...</td>
      <td>False</td>
      <td>218.486679</td>
      <td>[0.0, 2.5, 73.5, 75.586952, 89.884816, 131.884...</td>
      <td>[96.0, 240.0, 230.00049833441304, 235.00013708...</td>
      <td>283.476487</td>
      <td>False</td>
      <td>1024.0</td>
      <td>[, ]</td>
      <td>424.0</td>
      <td>../datasets/lmd/proto/85b2d4e8637008f6b4e54e5c...</td>
      <td>[B/beevar2.mid]</td>
    </tr>
    <tr>
      <th>44034</th>
      <td>../datasets/lmd/lmd_full/6/69df67cd25dd33c1217...</td>
      <td>False</td>
      <td>228.828269</td>
      <td>[0.0, 1.25, 3.65, 102.78041, 105.1804100000000...</td>
      <td>[96.0, 100.0, 115.0000287500072, 100.0, 115.00...</td>
      <td>407.079384</td>
      <td>False</td>
      <td>1024.0</td>
      <td>[, ]</td>
      <td>382.0</td>
      <td>../datasets/lmd/proto/69df67cd25dd33c12177e159...</td>
      <td>[Schumann/Schuman Toccata op7.mid, Schumann/Sc...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Lets check the amount of files we would loose if we limit our files to exactly one time signature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">midi_df</span><span class="o">.</span><span class="n">num_time_signature_changes</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pie</span><span class="p">();</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Tracks without time signature changes&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/01_midi_drums_86_0.png" src="../_images/01_midi_drums_86_0.png" />
</div>
</div>
<p>We can also take a look at the most common instrument names in our dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;instrument_names&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">instrument_names</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                  354676
Bass               29532
Drums              19438
untitled           18471
Piano              16344
Strings            10922
Soprano            10478
Guitar             10126
Alto                9368
Tenor               8987
DRUMS               8013
Melody              6693
WinJammer Demo      6488
Voice               6270
Piano (hi)          4905
Piano (lo)          4900
Italian             4679
STRINGS             4003
bass                3785
MELODY              3775
Name: instrument_names, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>And also take a look at the most common names of our original filenames.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">midi_df</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;original_files&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">original_files</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;[^a-zA-Z]&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-48-4f9f4be492b3&gt;:1: FutureWarning: The default value of regex will change from True to False in a future version.
  midi_df.explode(&#39;original_files&#39;).original_files.str.replace(&#39;[^a-zA-Z]&#39;, &#39; &#39;).str.lower().str.split(&#39; &#39;).explode().value_counts().head(50)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>              1091324
mid            570786
midi            56765
various         42479
artists         36610
a               34883
the             34148
l               29181
s               28479
polyphone       24771
sure            23089
i               22765
m               20958
e               20792
t               19164
midis           19014
c               18162
b               17950
d               17712
n               17012
h               15452
o               15425
g               13303
you             13228
p               12267
k               12032
of              11890
poly            11836
in              11073
f               10433
beatles          9696
love             9246
r                8911
me               8901
j                8816
diversen         8643
my               8172
to               7585
divers           7025
w                6894
analisadas       6320
no               6073
de               5601
on               5373
and              5349
midirip          5017
it               4853
bach             4692
classical        4542
unsorted         4419
Name: original_files, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>An interesting aspect of this analyis reveals that the most common words in a text corpora do not often contain much information what the text is about because the grammar structure of the text introduces noise to the dataset.</p>
<p>There are basic algorithms such as <a class="reference external" href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf">tf-idf</a> which allows us to filter out the noise by asserting that a word which is common in many documents has little to no meaning (e.g. <em>the</em> or in our case <em>midi</em>) and therefore give it a low score.
Although if a significant subset of our file names contain a word that is not so common in the other file names (e.g. <em>beatles</em>) this <em>token</em> will receive a high rating.</p>
<p>For now we dont want to inspect this further but its always good to know such kind of algorithms as it helps to filter out the relevant data.</p>
<p>Its also good to make some sanity checks on our data.
One assumption would be that every file in which we did not detect a drum track also does not contain an instrument with the name <em>drums</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">explodeded_df</span> <span class="o">=</span> <span class="n">midi_df</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;instrument_names&#39;</span><span class="p">)</span>
<span class="n">explodeded_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">explodeded_df</span><span class="p">[</span><span class="s1">&#39;instrument_names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;drums&#39;</span><span class="p">,</span> <span class="s1">&#39;drum&#39;</span><span class="p">]))</span><span class="o">&amp;</span>
    <span class="p">(</span><span class="n">explodeded_df</span><span class="p">[</span><span class="s1">&#39;drums&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;midi_path&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>midi_path</th>
      <th>midi_error</th>
      <th>estimate_tempo</th>
      <th>tempi_sec</th>
      <th>tempi</th>
      <th>end_time</th>
      <th>drums</th>
      <th>resolution</th>
      <th>instrument_names</th>
      <th>num_time_signature_changes</th>
      <th>proto_path</th>
      <th>original_files</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>../datasets/lmd/lmd_full/0/0093ffc81428aabfa14...</td>
      <td>False</td>
      <td>190.000285</td>
      <td>[0.0]</td>
      <td>[190.0002850004275]</td>
      <td>137.151110</td>
      <td>False</td>
      <td>192.0</td>
      <td>Drums</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/0093ffc81428aabfa14aaa13...</td>
      <td>[M/Martha My Dear 3.mid, Beatles +GeorgeJohnPa...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>../datasets/lmd/lmd_full/0/032e298d9560fdbe954...</td>
      <td>False</td>
      <td>120.000180</td>
      <td>[0.0]</td>
      <td>[190.0002850004275]</td>
      <td>114.947196</td>
      <td>False</td>
      <td>120.0</td>
      <td>Drums</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/032e298d9560fdbe954d7551...</td>
      <td>[s/smetmoth.mid, S/smetmoth.mid]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>../datasets/lmd/lmd_full/0/043e1c01e58a4bb4499...</td>
      <td>False</td>
      <td>139.999977</td>
      <td>[0.0, 0.4285715, 7.071422000000001, 39.071422]</td>
      <td>[69.99998833333528, 140.00014000014, 60.0, 69....</td>
      <td>196.778591</td>
      <td>False</td>
      <td>120.0</td>
      <td>Drums</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/043e1c01e58a4bb44995ee38...</td>
      <td>[Songs+300/Tunnel_o.mid]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>../datasets/lmd/lmd_full/0/06f86377b1dbad0ebf0...</td>
      <td>False</td>
      <td>226.482465</td>
      <td>[0.0, 1.0, 15.608691999999998]</td>
      <td>[120.0, 115.0000287500072, 120.0]</td>
      <td>59.483692</td>
      <td>False</td>
      <td>192.0</td>
      <td>DRUMS</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/06f86377b1dbad0ebf08fdcd...</td>
      <td>[s/seaquest2.mid, S/seaquest2.mid]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>../datasets/lmd/lmd_full/0/078e2cc7c46eb5de726...</td>
      <td>False</td>
      <td>204.052854</td>
      <td>[0.0]</td>
      <td>[98.00014373354414]</td>
      <td>281.211322</td>
      <td>False</td>
      <td>192.0</td>
      <td>Drums</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/078e2cc7c46eb5de72621329...</td>
      <td>[Pop/SLEGDEHM.MID, PeterGabriel/Sledgehammer6....</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>148</th>
      <td>../datasets/lmd/lmd_full/f/f2a97c0f7fa26244a77...</td>
      <td>False</td>
      <td>218.459582</td>
      <td>[0.0]</td>
      <td>[70.00007000007]</td>
      <td>213.553358</td>
      <td>False</td>
      <td>192.0</td>
      <td>drums</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/f2a97c0f7fa26244a77a8d0f...</td>
      <td>[u/unchainedmelody3.mid, U/UnchainedMelody3.mid]</td>
    </tr>
    <tr>
      <th>149</th>
      <td>../datasets/lmd/lmd_full/f/f6702b2445a6ce9aa8e...</td>
      <td>False</td>
      <td>211.143695</td>
      <td>[0.0]</td>
      <td>[120.0]</td>
      <td>21.241667</td>
      <td>False</td>
      <td>480.0</td>
      <td>Drums</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/f6702b2445a6ce9aa8e6cad8...</td>
      <td>[e/ElectroJam.Mid, E/ElectroJam.Mid]</td>
    </tr>
    <tr>
      <th>150</th>
      <td>../datasets/lmd/lmd_full/f/f8a56c3ebc00bfef70d...</td>
      <td>False</td>
      <td>157.793103</td>
      <td>[0.0]</td>
      <td>[80.0]</td>
      <td>263.847656</td>
      <td>False</td>
      <td>192.0</td>
      <td>Drums</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/f8a56c3ebc00bfef70d033a8...</td>
      <td>[t/tearinhand.mid, T/tearinhand.mid]</td>
    </tr>
    <tr>
      <th>151</th>
      <td>../datasets/lmd/lmd_full/f/fa06799e6825c6a4095...</td>
      <td>False</td>
      <td>284.928064</td>
      <td>[0.0]</td>
      <td>[148.99983858350816]</td>
      <td>383.315852</td>
      <td>False</td>
      <td>240.0</td>
      <td>drums</td>
      <td>16.0</td>
      <td>../datasets/lmd/proto/fa06799e6825c6a4095e2934...</td>
      <td>[l/louder.mid, L/louder.mid]</td>
    </tr>
    <tr>
      <th>152</th>
      <td>../datasets/lmd/lmd_full/f/fd37e5d1258ba97fc0e...</td>
      <td>False</td>
      <td>235.685752</td>
      <td>[0.0]</td>
      <td>[100.0]</td>
      <td>191.795000</td>
      <td>False</td>
      <td>120.0</td>
      <td>Drums</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/fd37e5d1258ba97fc0ef9779...</td>
      <td>[Christian/Easyway.mid, Various Artists/easywa...</td>
    </tr>
  </tbody>
</table>
<p>153 rows × 12 columns</p>
</div></div></div>
</div>
<p>Listening to those examples reveal that some of them use another instrument than drums for their drums - either by artistic choice or by mistake.
As this <em>only</em> applies to 153 files we can live with this error and ignore the files were we did not detect the drum track.</p>
</div>
<div class="section" id="filter-and-extract-the-data">
<h2>Filter and extract the data<a class="headerlink" href="#filter-and-extract-the-data" title="Permalink to this headline">¶</a></h2>
<p>After inspecting all availabe files we should filter out some <em>noisy</em> files that are either not interesting to us (they lack a drum track) or the parsing of the MIDI files did not work as expected.
With the analysis above we can verify borders of data we want to allow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filtered_midi_df</span> <span class="o">=</span> <span class="n">midi_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">midi_df</span><span class="o">.</span><span class="n">drums</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">midi_df</span><span class="o">.</span><span class="n">midi_error</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">midi_df</span><span class="o">.</span><span class="n">end_time</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">800</span><span class="p">))</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">midi_df</span><span class="o">.</span><span class="n">num_time_signature_changes</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">filtered_midi_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>midi_path</th>
      <th>midi_error</th>
      <th>estimate_tempo</th>
      <th>tempi_sec</th>
      <th>tempi</th>
      <th>end_time</th>
      <th>drums</th>
      <th>resolution</th>
      <th>instrument_names</th>
      <th>num_time_signature_changes</th>
      <th>proto_path</th>
      <th>original_files</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>5</th>
      <td>../datasets/lmd/lmd_full/9/9d30679480d0e55a07b...</td>
      <td>False</td>
      <td>224.502048</td>
      <td>[0.0]</td>
      <td>[115.00002875000717]</td>
      <td>296.347752</td>
      <td>True</td>
      <td>120.0</td>
      <td>[Piano, Organ, Big Brass, Horns, Horns2, Horns...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/9d30679480d0e55a07be1414...</td>
      <td>[S/Smooth .mid]</td>
    </tr>
    <tr>
      <th>9</th>
      <td>../datasets/lmd/lmd_full/9/974f5b2466a5d5670df...</td>
      <td>False</td>
      <td>184.213982</td>
      <td>[0.0, 2.714283, 170.86248999999998, 171.960050...</td>
      <td>[210.00021000021, 80.99997165000993, 82.000035...</td>
      <td>225.896259</td>
      <td>True</td>
      <td>120.0</td>
      <td>[, , , , , , , , , ]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/974f5b2466a5d5670dfddee0...</td>
      <td>[Sure.Polyphone.Midi/A Winter's Tale.mid, w/wi...</td>
    </tr>
    <tr>
      <th>10</th>
      <td>../datasets/lmd/lmd_full/9/952df587b9fff5adbeb...</td>
      <td>False</td>
      <td>265.636110</td>
      <td>[0.0]</td>
      <td>[144.0023040368646]</td>
      <td>216.460946</td>
      <td>True</td>
      <td>480.0</td>
      <td>[Track 2, Track 3, Track 4, Track 5, Track 6, ...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/952df587b9fff5adbeb5f40b...</td>
      <td>[E/Enola Gay 63.mid, divers midi 3/OMD_-_Enola...</td>
    </tr>
    <tr>
      <th>11</th>
      <td>../datasets/lmd/lmd_full/9/93e2cb3a0c36af361bb...</td>
      <td>False</td>
      <td>165.000165</td>
      <td>[0.0]</td>
      <td>[165.000165000165]</td>
      <td>310.029993</td>
      <td>True</td>
      <td>480.0</td>
      <td>[Chorus Guitar, Overdrive Guita, Overdrive Gui...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/93e2cb3a0c36af361bb49c5e...</td>
      <td>[z/zombie05.mid, Z/zombie05.mid]</td>
    </tr>
    <tr>
      <th>12</th>
      <td>../datasets/lmd/lmd_full/9/97c1f795ffb676dfaa5...</td>
      <td>False</td>
      <td>212.877687</td>
      <td>[0.0]</td>
      <td>[110.00011000011]</td>
      <td>222.766823</td>
      <td>True</td>
      <td>192.0</td>
      <td>[BASS, E.PIANO, GUITAR, STRINGS, PIANO, New Tr...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/97c1f795ffb676dfaa5a0202...</td>
      <td>[J/J. Rivers Poor Side of Town.mid, divers mid...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>178555</th>
      <td>../datasets/lmd/lmd_full/5/5bd52f314b616bf50c4...</td>
      <td>False</td>
      <td>141.332152</td>
      <td>[0.0, 183.428388, 186.85695800000002, 241.9283...</td>
      <td>[70.00007000007, 35.00001458333941, 70.0000700...</td>
      <td>250.221166</td>
      <td>True</td>
      <td>480.0</td>
      <td>[Track 1, Track 2, Track 3, Track 4, Track 6, ...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/5bd52f314b616bf50c40104c...</td>
      <td>[T/taylor_swift-tim_mcgraw.mid]</td>
    </tr>
    <tr>
      <th>178556</th>
      <td>../datasets/lmd/lmd_full/5/5eea68ee369af3ee5cc...</td>
      <td>False</td>
      <td>184.252715</td>
      <td>[0.0, 210.73867815, 210.75516165, 210.77763355...</td>
      <td>[90.00009000009, 91.00009100009099, 89.0000400...</td>
      <td>299.296908</td>
      <td>True</td>
      <td>240.0</td>
      <td>[You've Made Me So Very Happy, You've Made Me ...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/5eea68ee369af3ee5cc577ba...</td>
      <td>[Y/Youvemad L.mid, Y/YOUVEMAD L.mid, Y/YOUVEMA...</td>
    </tr>
    <tr>
      <th>178557</th>
      <td>../datasets/lmd/lmd_full/5/5309fb3f62bf73780e6...</td>
      <td>False</td>
      <td>183.172080</td>
      <td>[0.0]</td>
      <td>[81.01003309259853]</td>
      <td>139.390142</td>
      <td>True</td>
      <td>120.0</td>
      <td>[, , , , , , , , , ]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/5309fb3f62bf73780e61f85b...</td>
      <td>[R/Roberto Carlos - Propuesta L.mid, Midis Jov...</td>
    </tr>
    <tr>
      <th>178559</th>
      <td>../datasets/lmd/lmd_full/5/5538b0174111bcef760...</td>
      <td>False</td>
      <td>274.353398</td>
      <td>[0.0]</td>
      <td>[142.00007100003546]</td>
      <td>172.389879</td>
      <td>True</td>
      <td>96.0</td>
      <td>[Std Drums, Jazz Gtr, Muted Gtr (Lead Dbl), Mu...</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/5538b0174111bcef760a5f29...</td>
      <td>[B/Boys 2.mid, b/boys_2.mid, Beatles +GeorgeJo...</td>
    </tr>
    <tr>
      <th>178560</th>
      <td>../datasets/lmd/lmd_full/5/51e756897765aed30af...</td>
      <td>False</td>
      <td>229.821409</td>
      <td>[0.0]</td>
      <td>[64.99999458333379]</td>
      <td>293.317332</td>
      <td>True</td>
      <td>96.0</td>
      <td>[, , , , , ]</td>
      <td>1.0</td>
      <td>../datasets/lmd/proto/51e756897765aed30af232df...</td>
      <td>[G/Gerry Boulet Deadline.mid]</td>
    </tr>
  </tbody>
</table>
<p>97846 rows × 12 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_midi_df</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">midi_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5479696014247232
</pre></div>
</div>
</div>
</div>
<p>We now filtered half of our available examples by just looking at the metadata of the MIDI files.
The next step is to transform the drum track of each MIDI file into a mathematical representation.</p>
<p>The notatation within the MIDI file is bound to a strictly timely manner but in music we often put the timely domain in relation to a tempo which remaps the time measured in seconds.
A common unit for this is <em>beats per minute</em> (bpm) where 60 bpm maps each second to a <em>beat</em> - if we want to shorten the time between two beats (commonly refered to as <em>faster</em>) we increase the <em>bpm</em> and vice versa.</p>
<p>Another instance for the segmentation of events in time is the <em>time signature</em> of a track.</p>
<p>One notation which tries to simplify this notation is in the form of a <em>step seqencer</em> in which we snap notes to the nearest step on a grid</p>
<p>For this we can use <em>note_seq</em> with the function <a class="reference external" href="https://github.com/magenta/note-seq/blob/6631a4299092cd52201e2f4a8e36c1223d76561f/note_seq/drums_lib.py#L269">midi_file_to_drum_track</a>.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>We filtered out all noisy examples of our dataset and transformed the drum track into a mathematical, simplified notation.</p>
<p>In the next step we will start to analyse the drum patterns that we extracted.</p>
</div>
</div>


              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="../docs/basics/python.html" title="previous page">Python basics</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Dennis Scheiba<br/>
        
            &copy; Copyright 2021, Dennis Scheiba.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>